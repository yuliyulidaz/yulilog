<!DOCTYPE html>
<html lang="ko" class="h-full antialiased">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>발췌 문구 생성기</title>
    
    <!-- 폰트 로드 (최적화: 요청된 굵기 200, 300 반영) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@300&family=Noto+Sans+KR:wght@200&family=Nanum+Myeongjo&family=Nanum+Gothic&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/earlyaccess/kopubbatang.css">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Pretendard Variable', 'Pretendard', '-apple-system', 'BlinkMacSystemFont', 'system-ui', 'Roboto', 'Helvetica Neue', 'Segoe UI', 'Apple SD Gothic Neo', 'Noto Sans KR', 'Malgun Gothic', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'sans-serif'],
                        serif: ['Noto Serif KR', 'serif'],
                    },
                    colors: {
                        brand: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                        },
                        dark: {
                            bg: '#0f0f11',
                            panel: '#18181b',
                            border: '#27272a'
                        }
                    }
                }
            }
        }
    </script>

    <!-- Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <!-- Pickr (Color Picker) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/themes/classic.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/pickr.min.js"></script>

    <style>
        /* Custom Styles for inputs that Tailwind doesn't cover easily */
        input[type="range"] {
            -webkit-appearance: none;
            background: transparent;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #3b82f6;
            margin-top: -6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
            cursor: pointer;
        }
        input[type="range"]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #e2e8f0;
            border-radius: 2px;
        }
        .dark input[type="range"]::-webkit-slider-runnable-track {
            background: #3f3f46;
        }

        /* Hide scrollbar for Chrome, Safari and Opera */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        /* Hide scrollbar for IE, Edge and Firefox */
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        
        /* Custom Scrollbar for sidebar (Dark mode compatible) */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #3f3f46;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .glass-panel {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        .dark .glass-panel {
            background: rgba(24, 24, 27, 0.7);
        }
        
        .pattern-grid {
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
            background-size: 20px 20px;
        }
        .dark .pattern-grid {
            background-image: radial-gradient(#3f3f46 1px, transparent 1px);
        }

        /* Pickr Customization to Fill Container */
        .pickr {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .pickr .pcr-button {
            width: 100% !important;
            height: 100% !important;
            border-radius: 0 !important;
            box-shadow: none !important;
        }
        .pickr .pcr-button::before {
            border-radius: 0 !important;
        }
        .pcr-app {
            z-index: 9999 !important;
            font-family: 'Pretendard', sans-serif !important;
        }

        /* --- New Mobile Input Styling --- */
        /* Hide Spinners */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
        input[type=number] {
            -moz-appearance: textfield;
            background: transparent;
            text-align: center;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-weight: 700;
            outline: none;
            width: 3rem;
        }
        /* Button Active State for Long Press */
        .btn-pressing {
            background-color: #e2e8f0 !important;
            transform: scale(0.95);
        }
        .dark .btn-pressing {
            background-color: #3f3f46 !important;
        }
        /* Tip Animation */
        @keyframes tip-flash {
            0% { transform: scale(1); filter: brightness(1); }
            50% { transform: scale(1.05); filter: brightness(1.1); }
            100% { transform: scale(1); filter: brightness(1); }
        }
        .animate-tip {
            animation: tip-flash 0.3s ease-in-out;
        }

        /* Mobile Editor Modal Animation */
        #mobile-editor-modal {
            transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }
        #mobile-editor-modal.hidden-modal {
            transform: translateY(100%);
        }
        #mobile-editor-modal.visible-modal {
            transform: translateY(0);
        }
        
        /* Transition for Textarea height expansion */
        textarea#quote {
            transition: height 0.3s ease, border-color 0.2s ease, box-shadow 0.2s ease;
        }
    </style>
<script type="importmap">
{
  "imports": {
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "react": "https://aistudiocdn.com/react@^19.2.0"
  }
}
</script>
</head>
<body class="h-full bg-slate-50 dark:bg-zinc-950 text-slate-900 dark:text-slate-100 transition-colors duration-300 overflow-hidden flex flex-col items-center justify-center">

    <!-- App Container (Centered on large screens) -->
    <div class="w-full h-full max-w-[1200px] mx-auto bg-white dark:bg-dark-panel shadow-2xl flex flex-col border-x border-slate-200 dark:border-zinc-800">
        
        <!-- Header -->
        <header class="h-14 border-b border-slate-200 dark:border-dark-border flex items-center justify-between px-4 lg:px-6 bg-white dark:bg-dark-panel z-40 flex-shrink-0">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-brand-600 rounded-lg flex items-center justify-center text-white font-bold text-lg shadow-lg shadow-brand-500/30">
                    <i class="ph ph-quotes"></i>
                </div>
                <!-- Title hidden on mobile to make room for buttons -->
                <h1 class="font-bold text-lg tracking-tight hidden md:block">발췌 문구 생성기</h1>
            </div>
            
            <div class="flex items-center gap-2">
                <!-- Mobile & Desktop Actions -->
                
                <button onclick="toggleDarkMode()" class="w-9 h-9 rounded-full flex items-center justify-center text-slate-500 hover:bg-slate-100 dark:hover:bg-slate-800 transition-all dark-mode-toggle mr-1">
                    <i class="ph ph-moon text-xl"></i>
                </button>

                <!-- Copy Button (Mobile Visible with Text - HIDDEN on iOS/Android) -->
                <button onclick="copyImage()" class="copy-btn md:hidden flex items-center gap-1.5 px-3 py-1.5 bg-slate-100 dark:bg-zinc-800 text-slate-700 dark:text-slate-200 text-xs font-bold rounded-lg border border-slate-200 dark:border-zinc-700 active:scale-95 transition-transform">
                    <i class="ph ph-copy text-base"></i>
                    <span>복사</span>
                </button>

                <!-- Save Button (Mobile Visible with Text) -->
                <button onclick="downloadImage()" class="md:hidden flex items-center gap-1.5 px-3 py-1.5 bg-brand-600 text-white text-xs font-bold rounded-lg shadow-sm active:scale-95 transition-transform">
                    <i class="ph ph-download-simple text-base"></i>
                    <span>저장</span>
                </button>
            </div>
        </header>

        <!-- Main Workspace -->
        <main class="flex-1 flex flex-col md:flex-row overflow-hidden relative">
            
            <!-- Workspace (Preview) - Mobile: Top (Order 1), Desktop: Right (Order 2) -->
            <section class="order-1 md:order-2 w-full md:flex-1 h-[40vh] md:h-auto bg-slate-100 dark:bg-[#09090b] relative flex flex-col items-center justify-center p-4 md:p-8 lg:p-12 pattern-grid overflow-hidden flex-shrink-0 z-0 border-b md:border-b-0 border-slate-200 dark:border-zinc-800">
                
                <div class="relative w-full h-full flex items-center justify-center">
                     <!-- Canvas Wrapper -->
                    <div class="relative shadow-[0_20px_60px_-15px_rgba(0,0,0,0.2)] dark:shadow-[0_20px_60px_-15px_rgba(0,0,0,0.5)] transition-all duration-300 transform" id="canvasContainer">
                        <canvas id="canvas" width="1080" height="1080" class="max-w-full max-h-[35vh] md:max-h-[85vh] object-contain bg-white rounded-sm"></canvas>
                    </div>
                </div>

                <!-- Floating Action Bar - Desktop Only -->
                <div class="hidden md:flex absolute bottom-6 left-1/2 -translate-x-1/2 items-center gap-2 p-1.5 bg-white/90 dark:bg-zinc-800/90 backdrop-blur shadow-xl border border-slate-200 dark:border-zinc-700 rounded-2xl z-20">
                    <button onclick="downloadImage()" class="flex items-center gap-2 px-5 py-2.5 bg-brand-600 hover:bg-brand-700 text-white rounded-xl font-medium transition-transform active:scale-95 shadow-lg shadow-brand-500/20">
                        <i class="ph ph-download-simple text-lg"></i>
                        <span>저장</span>
                    </button>
                    <div id="desktop-action-divider" class="w-px h-6 bg-slate-200 dark:bg-zinc-600 mx-1"></div>
                    <button onclick="copyImage()" class="copy-btn p-2.5 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-zinc-700 rounded-xl transition-colors" title="복사">
                        <i class="ph ph-copy text-xl"></i>
                    </button>
                </div>
                
            </section>

            <!-- Left Sidebar (Controls) - Mobile: Bottom (Order 2), Desktop: Left (Order 1) -->
            <aside class="order-2 md:order-1 w-full md:w-[400px] lg:w-[420px] bg-white dark:bg-dark-panel border-t md:border-t-0 md:border-r border-slate-200 dark:border-dark-border flex flex-col flex-1 md:flex-none md:h-full z-30 md:shadow-none relative overflow-hidden" id="sidebar">
                
                <div class="h-full overflow-y-auto custom-scrollbar p-5 space-y-8 pb-10 md:pb-5">

                    <!-- Section: Content -->
                    <section class="space-y-4">
                        <div class="flex items-center justify-between flex-wrap gap-2">
                            <div class="flex items-center gap-2">
                                <h2 class="text-xs font-bold text-slate-400 dark:text-slate-500 uppercase tracking-wider">내용 입력</h2>
                                <!-- Indentation Toggle -->
                                <button onclick="toggleIndentation()" id="btn-indent" class="flex items-center gap-1 text-[10px] font-medium text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors py-0.5 px-2 rounded-full border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800">
                                    <i class="ph ph-text-indent" id="icon-indent"></i>
                                    <span id="text-indent">들여쓰기 OFF</span>
                                </button>
                            </div>
                            <div class="flex gap-2">
                                <!-- Mobile Expand -->
                                <button onclick="openMobileEditor()" class="md:hidden text-xs text-brand-600 hover:text-brand-700 font-medium flex items-center gap-1 bg-brand-50 px-2 py-1 rounded-md">
                                    <i class="ph ph-arrows-out-simple"></i> 크게 입력
                                </button>

                                <!-- Desktop Expand Toggle (Moved here) -->
                                <button onclick="toggleDesktopEditorSize()" id="btn-expand-editor" class="hidden md:flex text-xs text-brand-600 hover:text-brand-700 font-medium items-center gap-1 bg-brand-50 hover:bg-brand-100 dark:bg-brand-900/30 dark:hover:bg-brand-900/50 px-2 py-1 rounded-md transition-colors group" title="입력창 크기 조절">
                                    <i class="ph ph-arrows-vertical" id="icon-expand"></i>
                                    <span>크게 입력</span>
                                </button>

                                <button onclick="clearQuoteTextOnly()" class="text-xs text-red-500 hover:text-red-600 font-medium flex items-center gap-1 px-2 py-1">
                                    <i class="ph ph-eraser"></i> 지우기
                                </button>
                            </div>
                        </div>
                        
                        <div class="relative group">
                            <!-- Added resize-y for manual resizing on desktop -->
                            <textarea id="quote" placeholder="여기에 문구를 입력하세요..." class="w-full h-32 p-4 bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-slate-700 rounded-xl resize-y focus:outline-none focus:ring-2 focus:ring-brand-500/50 focus:border-brand-500 transition-all text-sm leading-relaxed placeholder:text-slate-400 overflow-y-auto overscroll-y-contain"></textarea>
                            <div class="absolute bottom-3 right-3 text-slate-400 pointer-events-none">
                                <i class="ph ph-pencil-simple"></i>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-3">
                            <div class="space-y-1.5">
                                <label class="text-xs font-medium text-slate-500">제작자</label>
                                <input type="text" id="author" placeholder="제작자 (선택)" class="w-full px-3 py-2.5 bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-slate-700 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500/50 focus:border-brand-500 transition-all">
                            </div>
                            <div class="space-y-1.5">
                                <label class="text-xs font-medium text-slate-500">캐릭터/제목</label>
                                <input type="text" id="title" placeholder="캐릭터/제목 (선택)" class="w-full px-3 py-2.5 bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-slate-700 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500/50 focus:border-brand-500 transition-all">
                            </div>
                        </div>
                    </section>

                    <hr class="border-slate-100 dark:border-slate-800">

                    <!-- Section: Canvas Settings -->
                    <section class="space-y-4">
                        <h2 class="text-xs font-bold text-slate-400 dark:text-slate-500 uppercase tracking-wider">캔버스 비율</h2>
                        
                        <!-- Ratio Selection: Icons -->
                        <div class="grid grid-cols-3 gap-3">
                            <button onclick="setRatio('1:1')" id="btn-ratio-1-1" class="ratio-btn flex flex-col items-center justify-center gap-2 p-3 rounded-xl border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800 transition-all bg-brand-50 dark:bg-slate-800 border-brand-500 dark:border-slate-500 ring-1 ring-brand-500 dark:ring-slate-500">
                                <div class="w-6 h-6 border-2 border-current rounded-sm"></div>
                                <span class="text-[10px] font-medium">1:1</span>
                            </button>
                            <button onclick="setRatio('4:5')" id="btn-ratio-4-5" class="ratio-btn flex flex-col items-center justify-center gap-2 p-3 rounded-xl border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800 transition-all">
                                <div class="w-5 h-6 border-2 border-current rounded-sm"></div>
                                <span class="text-[10px] font-medium">4:5</span>
                            </button>
                            <button onclick="setRatio('16:9')" id="btn-ratio-16-9" class="ratio-btn flex flex-col items-center justify-center gap-2 p-3 rounded-xl border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800 transition-all">
                                <div class="w-8 h-5 border-2 border-current rounded-sm mt-1 mb-0.5"></div>
                                <span class="text-[10px] font-medium">16:9</span>
                            </button>
                        </div>
                    </section>

                    <hr class="border-slate-100 dark:border-slate-800">

                    <!-- Section: Typography -->
                    <section class="space-y-4">
                        <h2 class="text-xs font-bold text-slate-400 dark:text-slate-500 uppercase tracking-wider">텍스트 스타일</h2>
                        
                        <!-- Font Family Selection -->
                        <div class="space-y-2">
                            <!-- Serif Group -->
                            <div class="grid grid-cols-3 gap-2">
                                <button onclick="setFont('Noto Serif KR')" class="font-btn p-2 text-xs border border-slate-200 dark:border-slate-700 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800 transition-all active-font" data-font="Noto Serif KR" style="font-family: 'Noto Serif KR', serif;">Noto Serif</button>
                                <button onclick="setFont('KoPub Batang')" class="font-btn p-2 text-xs border border-slate-200 dark:border-slate-700 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800 transition-all" data-font="KoPub Batang" style="font-family: 'KoPub Batang', serif;">KoPub 바탕</button>
                                <button onclick="setFont('Nanum Myeongjo')" class="font-btn p-2 text-xs border border-slate-200 dark:border-slate-700 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800 transition-all" data-font="Nanum Myeongjo" style="font-family: 'Nanum Myeongjo', serif;">나눔명조</button>
                            </div>
                            <!-- Sans-Serif Group -->
                            <div class="grid grid-cols-3 gap-2">
                                <button onclick="setFont('Pretendard')" class="font-btn p-2 text-xs border border-slate-200 dark:border-slate-700 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800 transition-all" data-font="Pretendard" style="font-family: 'Pretendard', sans-serif;">Pretendard</button>
                                <button onclick="setFont('Noto Sans KR')" class="font-btn p-2 text-xs border border-slate-200 dark:border-slate-700 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800 transition-all" data-font="Noto Sans KR" style="font-family: 'Noto Sans KR', sans-serif;">Noto Sans</button>
                                <button onclick="setFont('Nanum Gothic')" class="font-btn p-2 text-xs border border-slate-200 dark:border-slate-700 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800 transition-all" data-font="Nanum Gothic" style="font-family: 'Nanum Gothic', sans-serif;">나눔고딕</button>
                            </div>
                        </div>

                        <!-- Alignment & Break -->
                        <div class="grid grid-cols-2 gap-3">
                            <div class="bg-slate-50 dark:bg-black/20 p-1 rounded-lg flex border border-slate-200 dark:border-slate-700">
                                <!-- Radio Group for Align -->
                                <label class="flex-1 cursor-pointer">
                                    <input type="radio" name="align" value="left" checked class="peer hidden" id="align-left">
                                    <div class="w-full h-8 flex items-center justify-center rounded text-slate-400 peer-checked:bg-white dark:peer-checked:bg-slate-700 peer-checked:text-brand-600 peer-checked:shadow-sm transition-all">
                                        <i class="ph ph-text-align-left text-lg"></i>
                                    </div>
                                </label>
                                <label class="flex-1 cursor-pointer">
                                    <input type="radio" name="align" value="center" class="peer hidden" id="align-center">
                                    <div class="w-full h-8 flex items-center justify-center rounded text-slate-400 peer-checked:bg-white dark:peer-checked:bg-slate-700 peer-checked:text-brand-600 peer-checked:shadow-sm transition-all">
                                        <i class="ph ph-text-align-center text-lg"></i>
                                    </div>
                                </label>
                                <label class="flex-1 cursor-pointer">
                                    <input type="radio" name="align" value="right" class="peer hidden" id="align-right">
                                    <div class="w-full h-8 flex items-center justify-center rounded text-slate-400 peer-checked:bg-white dark:peer-checked:bg-slate-700 peer-checked:text-brand-600 peer-checked:shadow-sm transition-all">
                                        <i class="ph ph-text-align-right text-lg"></i>
                                    </div>
                                </label>
                                <label class="flex-1 cursor-pointer">
                                    <input type="radio" name="align" value="justify" class="peer hidden" id="align-justify">
                                    <div class="w-full h-8 flex items-center justify-center rounded text-slate-400 peer-checked:bg-white dark:peer-checked:bg-slate-700 peer-checked:text-brand-600 peer-checked:shadow-sm transition-all">
                                        <i class="ph ph-text-align-justify text-lg"></i>
                                    </div>
                                </label>
                            </div>

                            <div class="bg-slate-50 dark:bg-black/20 p-1 rounded-lg flex border border-slate-200 dark:border-slate-700">
                                 <label class="flex-1 cursor-pointer">
                                    <input type="radio" name="linebreak" value="char" checked class="peer hidden" id="linebreak-char">
                                    <div class="w-full h-8 flex items-center justify-center rounded text-xs font-medium text-slate-400 peer-checked:bg-white dark:peer-checked:bg-slate-700 peer-checked:text-brand-600 peer-checked:shadow-sm transition-all">
                                        글자
                                    </div>
                                </label>
                                <label class="flex-1 cursor-pointer">
                                    <input type="radio" name="linebreak" value="word" class="peer hidden" id="linebreak-word">
                                    <div class="w-full h-8 flex items-center justify-center rounded text-xs font-medium text-slate-400 peer-checked:bg-white dark:peer-checked:bg-slate-700 peer-checked:text-brand-600 peer-checked:shadow-sm transition-all">
                                        단어
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- 
                          RESPONSIVE CONTROLS:
                          1. Desktop/Tablet (md:block): Sliders
                          2. Mobile (md:hidden): Button Steppers (2x2 Grid) with Input
                        -->

                        <!-- MOBILE VIEW: Button Steppers (2x2 Grid) -->
                        <div class="md:hidden space-y-2 pt-2">
                             <!-- NEW: Tip Location (Above Grid) with ID for animation -->
                             <div id="mobile-tip-container" class="text-center transition-opacity duration-300 opacity-70">
                                <p class="text-[10px] text-brand-600 dark:text-brand-400 flex items-center justify-center gap-1 font-medium bg-brand-50 dark:bg-brand-900/30 py-1 px-2 rounded-full inline-flex">
                                    <i class="ph ph-lightbulb text-brand-500"></i>
                                    <span>Tip: 버튼을 꾹 누르면 빠르게 조절돼요</span>
                                </p>
                             </div>

                             <div class="grid grid-cols-2 gap-3">
                                <!-- Card 1: Font Size -->
                                <div class="bg-slate-50 dark:bg-black/20 p-3 rounded-xl border border-slate-200 dark:border-slate-700 flex flex-col justify-between">
                                    <label class="text-xs font-medium text-slate-500 mb-2">글자 크기</label>
                                    <div class="flex items-center justify-between bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-1">
                                        <button id="btn-minus-fontSize" class="w-8 h-8 flex items-center justify-center text-slate-500 hover:text-brand-600 rounded select-none"><i class="ph ph-minus"></i></button>
                                        <div class="flex items-center gap-0.5">
                                            <input type="number" id="input-mobile-fontSize" class="text-brand-600 text-sm">
                                            <span class="text-xs text-slate-400 font-medium">px</span>
                                        </div>
                                        <button id="btn-plus-fontSize" class="w-8 h-8 flex items-center justify-center text-slate-500 hover:text-brand-600 rounded select-none"><i class="ph ph-plus"></i></button>
                                    </div>
                                </div>
                                <!-- Card 2: Line Height -->
                                <div class="bg-slate-50 dark:bg-black/20 p-3 rounded-xl border border-slate-200 dark:border-slate-700 flex flex-col justify-between">
                                    <label class="text-xs font-medium text-slate-500 mb-2">줄 간격</label>
                                    <div class="flex items-center justify-between bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-1">
                                        <button id="btn-minus-lineHeight" class="w-8 h-8 flex items-center justify-center text-slate-500 hover:text-brand-600 rounded select-none"><i class="ph ph-minus"></i></button>
                                        <div class="flex items-center gap-0.5">
                                            <input type="number" id="input-mobile-lineHeight" class="text-brand-600 text-sm" step="0.1">
                                            <span class="text-xs text-slate-400 font-medium">x</span>
                                        </div>
                                        <button id="btn-plus-lineHeight" class="w-8 h-8 flex items-center justify-center text-slate-500 hover:text-brand-600 rounded select-none"><i class="ph ph-plus"></i></button>
                                    </div>
                                </div>
                                <!-- Card 3: Paragraph Spacing -->
                                <div class="bg-slate-50 dark:bg-black/20 p-3 rounded-xl border border-slate-200 dark:border-slate-700 flex flex-col justify-between">
                                    <label class="text-xs font-medium text-slate-500 mb-2">문단 간격</label>
                                    <div class="flex items-center justify-between bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-1">
                                        <button id="btn-minus-paraSpacing" class="w-8 h-8 flex items-center justify-center text-slate-500 hover:text-brand-600 rounded select-none"><i class="ph ph-minus"></i></button>
                                        <div class="flex items-center gap-0.5">
                                            <input type="number" id="input-mobile-paraSpacing" class="text-brand-600 text-sm">
                                            <span class="text-xs text-slate-400 font-medium">px</span>
                                        </div>
                                        <button id="btn-plus-paraSpacing" class="w-8 h-8 flex items-center justify-center text-slate-500 hover:text-brand-600 rounded select-none"><i class="ph ph-plus"></i></button>
                                    </div>
                                </div>
                                <!-- Card 4: Padding -->
                                <div class="bg-slate-50 dark:bg-black/20 p-3 rounded-xl border border-slate-200 dark:border-slate-700 flex flex-col justify-between">
                                    <label class="text-xs font-medium text-slate-500 mb-2">여백</label>
                                    <div class="flex items-center justify-between bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-1">
                                        <button id="btn-minus-padding" class="w-8 h-8 flex items-center justify-center text-slate-500 hover:text-brand-600 rounded select-none"><i class="ph ph-minus"></i></button>
                                        <div class="flex items-center gap-0.5">
                                            <input type="number" id="input-mobile-padding" class="text-brand-600 text-sm">
                                            <span class="text-xs text-slate-400 font-medium">px</span>
                                        </div>
                                        <button id="btn-plus-padding" class="w-8 h-8 flex items-center justify-center text-slate-500 hover:text-brand-600 rounded select-none"><i class="ph ph-plus"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- DESKTOP VIEW: Sliders (Existing) -->
                        <div class="hidden md:block space-y-5 pt-2">
                            <div class="relative">
                                <div class="flex justify-between text-xs mb-2">
                                    <span class="text-slate-500">글자 크기</span>
                                    <span class="font-mono text-brand-600"><span id="fontSizeValue">42</span>px</span>
                                </div>
                                <input type="range" id="fontSize" min="30" max="80" value="42" class="w-full">
                            </div>
                            <div class="relative">
                                <div class="flex justify-between text-xs mb-2">
                                    <span class="text-slate-500">줄 간격</span>
                                    <span class="font-mono text-brand-600"><span id="lineHeightValue">1.5</span>x</span>
                                </div>
                                <input type="range" id="lineHeight" min="1.2" max="2.0" step="0.1" value="1.5" class="w-full">
                            </div>
                            <div class="relative">
                                <div class="flex justify-between text-xs mb-2">
                                    <span class="text-slate-500">문단 간격</span>
                                    <span class="font-mono text-brand-600"><span id="paraSpacingValue">0</span>px</span>
                                </div>
                                <input type="range" id="paraSpacing" min="0" max="100" value="0" class="w-full">
                            </div>
                            <div class="relative">
                                <div class="flex justify-between text-xs mb-2">
                                    <span class="text-slate-500">여백</span>
                                    <span class="font-mono text-brand-600"><span id="paddingValue">100</span>px</span>
                                </div>
                                <input type="range" id="padding" min="50" max="200" step="10" value="100" class="w-full">
                            </div>
                        </div>
                    </section>

                    <hr class="border-slate-100 dark:border-slate-800">

                    <!-- Section: Style & Color -->
                    <section class="space-y-4">
                        <h2 class="text-xs font-bold text-slate-400 dark:text-slate-500 uppercase tracking-wider">배경 및 스타일</h2>
                        
                        <div class="space-y-4">
                            <!-- 1. Text Color -->
                            <div class="space-y-2">
                                <label class="text-xs font-medium text-slate-500">글자 색상</label>
                                <div class="relative w-full h-10 rounded-lg border border-slate-200 dark:border-slate-700 overflow-hidden shadow-sm">
                                    <div id="textColorPicker"></div>
                                </div>
                            </div>

                            <!-- 2. Background Mode Toggle (Default to Gradient) -->
                            <div class="bg-slate-50 dark:bg-black/20 p-1 rounded-lg flex border border-slate-200 dark:border-slate-700">
                                <label class="flex-1 cursor-pointer">
                                    <input type="radio" name="bgMode" value="solid" class="peer hidden">
                                    <div class="w-full h-8 flex items-center justify-center rounded text-xs font-medium text-slate-400 peer-checked:bg-white dark:peer-checked:bg-slate-700 peer-checked:text-brand-600 peer-checked:shadow-sm transition-all">
                                        단색
                                    </div>
                                </label>
                                <label class="flex-1 cursor-pointer">
                                    <input type="radio" name="bgMode" value="gradient" checked class="peer hidden">
                                    <div class="w-full h-8 flex items-center justify-center rounded text-xs font-medium text-slate-400 peer-checked:bg-white dark:peer-checked:bg-slate-700 peer-checked:text-brand-600 peer-checked:shadow-sm transition-all">
                                        그라데이션
                                    </div>
                                </label>
                            </div>

                            <!-- 3. Solid Color Settings (Hidden by default) -->
                            <div id="solidColorPanel" class="space-y-2 hidden">
                                <label class="text-xs font-medium text-slate-500">배경 색상</label>
                                <div class="relative w-full h-10 rounded-lg border border-slate-200 dark:border-slate-700 overflow-hidden shadow-sm">
                                    <div id="bgColorMainPicker"></div>
                                </div>
                            </div>

                            <!-- 4. Gradient Settings (Visible by default) -->
                            <div id="gradientColorPanel" class="space-y-3">
                                <div class="grid grid-cols-2 gap-3">
                                    <div class="space-y-2">
                                        <label class="text-xs font-medium text-slate-500">시작 색상</label>
                                        <div class="relative w-full h-10 rounded-lg border border-slate-200 dark:border-slate-700 overflow-hidden shadow-sm">
                                            <div id="gradStartColorPicker"></div>
                                        </div>
                                    </div>
                                    <div class="space-y-2">
                                        <label class="text-xs font-medium text-slate-500">끝 색상</label>
                                        <div class="relative w-full h-10 rounded-lg border border-slate-200 dark:border-slate-700 overflow-hidden shadow-sm">
                                            <div id="gradEndColorPicker"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="space-y-2">
                                    <label class="text-xs font-medium text-slate-500">방향</label>
                                    <!-- Direction Grid Icons -->
                                    <div class="grid grid-cols-4 gap-2">
                                        <!-- Top Row -->
                                        <button onclick="setDirection('to bottom')" class="dir-btn h-9 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800 transition-all flex items-center justify-center text-slate-500" data-dir="to bottom" title="상 → 하"><i class="ph ph-arrow-down"></i></button>
                                        <button onclick="setDirection('to top')" class="dir-btn h-9 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800 transition-all flex items-center justify-center text-slate-500" data-dir="to top" title="하 → 상"><i class="ph ph-arrow-up"></i></button>
                                        <button onclick="setDirection('to right')" class="dir-btn h-9 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800 transition-all flex items-center justify-center text-slate-500" data-dir="to right" title="좌 → 우"><i class="ph ph-arrow-right"></i></button>
                                        <button onclick="setDirection('to left')" class="dir-btn h-9 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800 transition-all flex items-center justify-center text-slate-500" data-dir="to left" title="우 → 좌"><i class="ph ph-arrow-left"></i></button>
                                        
                                        <!-- Bottom Row -->
                                        <button onclick="setDirection('to bottom right')" class="dir-btn h-9 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800 transition-all flex items-center justify-center text-slate-500 active-dir bg-brand-50 dark:bg-slate-800 border-brand-500 dark:border-slate-500 text-brand-600 dark:text-brand-400" data-dir="to bottom right" title="좌상 → 우하"><i class="ph ph-arrow-down-right"></i></button>
                                        <button onclick="setDirection('to top right')" class="dir-btn h-9 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800 transition-all flex items-center justify-center text-slate-500" data-dir="to top right" title="좌하 → 우상"><i class="ph ph-arrow-up-right"></i></button>
                                        <button onclick="setDirection('to bottom left')" class="dir-btn h-9 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800 transition-all flex items-center justify-center text-slate-500" data-dir="to bottom left" title="우상 → 좌하"><i class="ph ph-arrow-down-left"></i></button>
                                        <button onclick="setDirection('to top left')" class="dir-btn h-9 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800 transition-all flex items-center justify-center text-slate-500" data-dir="to top left" title="우하 → 좌상"><i class="ph ph-arrow-up-left"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 5. Color Presets (Split: Solid vs Gradient) -->
                        <div class="pt-1">
                            <!-- Gradient Palette -->
                            <div id="gradientPalette" class="flex gap-2 overflow-x-auto no-scrollbar py-1">
                                <button onclick="setPreset('gradient', '#a18cd1', '#fbc2eb', '#4A4A4A')" class="w-8 h-8 rounded-full border border-slate-200 shadow-sm flex-shrink-0" style="background: linear-gradient(to bottom right, #a18cd1, #fbc2eb)" title="Dreamy Purple"></button>
                                <button onclick="setPreset('gradient', '#0f2027', '#203a43', '#ffffff')" class="w-8 h-8 rounded-full border border-slate-200 shadow-sm flex-shrink-0" style="background: linear-gradient(to bottom right, #0f2027, #2c5364)" title="Deep Sea"></button>
                                <button onclick="setPreset('gradient', '#232526', '#414345', '#ffffff')" class="w-8 h-8 rounded-full border border-slate-200 shadow-sm flex-shrink-0" style="background: linear-gradient(to bottom right, #232526, #414345)" title="Midnight"></button>
                                <button onclick="setPreset('gradient', '#4b1248', '#f0c27b', '#ffffff')" class="w-8 h-8 rounded-full border border-slate-200 shadow-sm flex-shrink-0" style="background: linear-gradient(to bottom right, #4b1248, #f0c27b)" title="Sunset"></button>
                                <button onclick="setPreset('gradient', '#141E30', '#243B55', '#ffffff')" class="w-8 h-8 rounded-full border border-slate-200 shadow-sm flex-shrink-0" style="background: linear-gradient(to bottom right, #141E30, #243B55)" title="Royal Blue"></button>
                                <button onclick="setPreset('gradient', '#1a2a6c', '#b21f1f', '#ffffff')" class="w-8 h-8 rounded-full border border-slate-200 shadow-sm flex-shrink-0" style="background: linear-gradient(to bottom right, #1a2a6c, #b21f1f)" title="Mystic"></button>
                                <button onclick="setPreset('gradient', '#000000', '#434343', '#ffffff')" class="w-8 h-8 rounded-full border border-slate-200 shadow-sm flex-shrink-0" style="background: linear-gradient(to bottom right, #000000, #434343)" title="Charcoal"></button>
                            </div>
                            
                            <!-- Solid Palette (Hidden initially if gradient is default) -->
                            <div id="solidPalette" class="flex gap-2 overflow-x-auto no-scrollbar py-1 hidden">
                                <button onclick="setPreset('solid', '#E6E6FA', null, '#000000')" class="w-8 h-8 rounded-full bg-[#E6E6FA] border border-slate-200 shadow-sm flex-shrink-0" title="Lavender"></button>
                                <button onclick="setPreset('solid', '#000000', null, '#ffffff')" class="w-8 h-8 rounded-full bg-black border border-slate-200 shadow-sm flex-shrink-0" title="Black"></button>
                                <button onclick="setPreset('solid', '#1a1a1a', null, '#ffffff')" class="w-8 h-8 rounded-full bg-[#1a1a1a] border border-slate-200 shadow-sm flex-shrink-0" title="Dark Gray"></button>
                                <button onclick="setPreset('solid', '#1e293b', null, '#ffffff')" class="w-8 h-8 rounded-full bg-[#1e293b] border border-slate-200 shadow-sm flex-shrink-0" title="Slate"></button>
                                <button onclick="setPreset('solid', '#312e81', null, '#ffffff')" class="w-8 h-8 rounded-full bg-[#312e81] border border-slate-200 shadow-sm flex-shrink-0" title="Indigo"></button>
                                <button onclick="setPreset('solid', '#4a044e', null, '#ffffff')" class="w-8 h-8 rounded-full bg-[#4a044e] border border-slate-200 shadow-sm flex-shrink-0" title="Fuchsia"></button>
                                <button onclick="setPreset('solid', '#365314', null, '#ffffff')" class="w-8 h-8 rounded-full bg-[#365314] border border-slate-200 shadow-sm flex-shrink-0" title="Olive"></button>
                                <button onclick="setPreset('solid', '#881337', null, '#ffffff')" class="w-8 h-8 rounded-full bg-[#881337] border border-slate-200 shadow-sm flex-shrink-0" title="Rose"></button>
                            </div>
                        </div>

                        <!-- 6. Background Image -->
                        <div class="pt-2">
                            <label class="flex items-center justify-center w-full h-24 border-2 border-dashed border-slate-300 dark:border-slate-700 rounded-xl hover:border-brand-500 dark:hover:border-brand-500 hover:bg-slate-50 dark:hover:bg-slate-800 transition-all cursor-pointer group">
                                <div class="text-center">
                                    <div class="text-slate-400 group-hover:text-brand-500 transition-colors mb-1">
                                        <i class="ph ph-image text-2xl"></i>
                                    </div>
                                    <span class="text-xs text-slate-500 group-hover:text-slate-700 dark:group-hover:text-slate-300">배경 이미지 업로드</span>
                                </div>
                                <input type="file" id="bgImageUpload" accept="image/*" class="hidden">
                            </label>
                            
                            <div id="imageControlPanel" class="hidden mt-3 p-3 bg-slate-50 dark:bg-black/20 rounded-xl border border-slate-200 dark:border-slate-700 space-y-3">
                                <div class="flex justify-between items-center">
                                    <span id="imageFileName" class="text-xs text-slate-500 truncate max-w-[150px]"></span>
                                    <button id="btnImageDelete" onclick="deleteBackgroundImage()" class="text-xs text-red-500 hover:bg-red-50 p-1 rounded transition-colors"><i class="ph ph-trash"></i> 삭제</button>
                                </div>
                                
                                <!-- Image Controls -->
                                <div id="imageOptions" class="space-y-3">
                                    <div class="flex bg-white dark:bg-slate-800 rounded-lg p-1 border border-slate-200 dark:border-slate-700">
                                        <label class="flex-1 cursor-pointer text-center">
                                            <input type="radio" name="imageFit" value="cover" checked class="peer hidden" id="fit-cover">
                                            <span class="block text-xs py-1 rounded text-slate-500 peer-checked:bg-brand-50 peer-checked:text-brand-600 font-medium">채우기</span>
                                        </label>
                                        <label class="flex-1 cursor-pointer text-center">
                                            <input type="radio" name="imageFit" value="contain" class="peer hidden" id="fit-contain">
                                            <span class="block text-xs py-1 rounded text-slate-500 peer-checked:bg-brand-50 peer-checked:text-brand-600 font-medium">맞추기</span>
                                        </label>
                                    </div>
                                    
                                    <div class="grid grid-cols-3 gap-1 max-w-[120px] mx-auto">
                                        <!-- 3x3 Grid for Position -->
                                        <label class="aspect-square cursor-pointer"><input type="radio" name="imagePosition" value="top-left" class="peer hidden"><div class="w-full h-full border border-slate-200 rounded hover:bg-slate-100 peer-checked:bg-brand-500 peer-checked:border-brand-500"></div></label>
                                        <label class="aspect-square cursor-pointer"><input type="radio" name="imagePosition" value="top-center" class="peer hidden"><div class="w-full h-full border border-slate-200 rounded hover:bg-slate-100 peer-checked:bg-brand-500 peer-checked:border-brand-500"></div></label>
                                        <label class="aspect-square cursor-pointer"><input type="radio" name="imagePosition" value="top-right" class="peer hidden"><div class="w-full h-full border border-slate-200 rounded hover:bg-slate-100 peer-checked:bg-brand-500 peer-checked:border-brand-500"></div></label>
                                        
                                        <label class="aspect-square cursor-pointer"><input type="radio" name="imagePosition" value="middle-left" class="peer hidden"><div class="w-full h-full border border-slate-200 rounded hover:bg-slate-100 peer-checked:bg-brand-500 peer-checked:border-brand-500"></div></label>
                                        <label class="aspect-square cursor-pointer"><input type="radio" name="imagePosition" value="middle-center" checked class="peer hidden"><div class="w-full h-full border border-slate-200 rounded hover:bg-slate-100 peer-checked:bg-brand-500 peer-checked:border-brand-500"></div></label>
                                        <label class="aspect-square cursor-pointer"><input type="radio" name="imagePosition" value="middle-right" class="peer hidden"><div class="w-full h-full border border-slate-200 rounded hover:bg-slate-100 peer-checked:bg-brand-500 peer-checked:border-brand-500"></div></label>
                                        
                                        <label class="aspect-square cursor-pointer"><input type="radio" name="imagePosition" value="bottom-left" class="peer hidden"><div class="w-full h-full border border-slate-200 rounded hover:bg-slate-100 peer-checked:bg-brand-500 peer-checked:border-brand-500"></div></label>
                                        <label class="aspect-square cursor-pointer"><input type="radio" name="imagePosition" value="bottom-center" class="peer hidden"><div class="w-full h-full border border-slate-200 rounded hover:bg-slate-100 peer-checked:bg-brand-500 peer-checked:border-brand-500"></div></label>
                                        <label class="aspect-square cursor-pointer"><input type="radio" name="imagePosition" value="bottom-right" class="peer hidden"><div class="w-full h-full border border-slate-200 rounded hover:bg-slate-100 peer-checked:bg-brand-500 peer-checked:border-brand-500"></div></label>
                                    </div>
                                    
                                    <div class="relative pt-2">
                                         <div class="flex justify-between text-xs mb-1">
                                            <span class="text-slate-500">이미지 크기</span>
                                            <span class="font-mono text-brand-600"><span id="scaleValue">100</span>%</span>
                                        </div>
                                        <input type="range" id="bgImageScale" min="10" max="200" value="100" class="w-full">
                                    </div>

                                    <div class="relative">
                                         <div class="flex justify-between text-xs mb-1">
                                            <span class="text-slate-500">오버레이</span>
                                            <span class="font-mono text-brand-600" id="overlayValueText">원본</span>
                                        </div>
                                        <input type="range" id="overlayOpacity" min="-80" max="80" value="0" class="w-full">
                                        <div class="flex justify-between text-[10px] text-slate-400 mt-1 px-1">
                                            <span>밝게</span>
                                            <span>원본</span>
                                            <span>어둡게</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <hr class="border-slate-100 dark:border-slate-800">

                    <!-- Section: Logo Settings -->
                    <section class="space-y-4">
                        <h2 class="text-xs font-bold text-slate-400 dark:text-slate-500 uppercase tracking-wider">로고 설정</h2>
                        
                         <div class="space-y-2">
                            <label class="text-xs font-medium text-slate-500">플랫폼 로고</label>
                            <select id="platformSelect" class="w-full appearance-none px-3 py-2.5 bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-slate-700 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500">
                                <option value="">선택 안함</option>
                                <option value="dokiChat">도키챗</option>
                                <option value="luvDuv">러비더비</option>
                                <option value="reppley">레플리</option>
                                <option value="rplay">로맨틱플레이</option>
                                <option value="ropanAI">로판AI</option>
                                <option value="melting">멜팅</option>
                                <option value="bloom">블룸</option>
                                <option value="inkChat">잉크챗</option>
                                <option value="zeta">제타</option>
                                <option value="carat">캐럿</option>
                                <option value="chemi">케밍</option>
                                <option value="caveDuck">케이브덕</option>
                                <option value="crack">크랙</option>
                                <option value="pulse">펄스</option>
                                <option value="Fizzchat">피즈챗</option>
                                <option value="whif">WHIF</option> 
                            </select>
                        </div>

                        <div class="space-y-1">
                             <div class="flex justify-between text-xs mb-1">
                                <span class="text-slate-500">로고 크기</span>
                                <span class="font-mono text-brand-600"><span id="logoSizeValue">80</span>px</span>
                            </div>
                            <input type="range" id="logoSize" min="50" max="200" step="10" value="80" class="w-full">
                        </div>
                    </section>
                    
                    <!-- Footer Info -->
                    <footer class="mt-8 pt-8 border-t border-slate-100 dark:border-slate-800 text-xs text-slate-400 dark:text-slate-500 space-y-4 pb-8">
                         <!-- Sister Site Link -->
                        <a href="https://yuliyulidaz.github.io/yulipage/" target="_blank" class="block w-full p-3 bg-brand-50/50 dark:bg-brand900/10 border border-brand-100 dark:border-brand-800/30 rounded-xl hover:bg-brand-50 dark:hover:bg-brand-900/20 transition-all group">
                            <div class="flex items-center gap-2 text-brand-600 dark:text-brand-400 font-bold mb-0.5">
                                <i class="ph ph-file-text text-lg"></i>
                                <span>내지 생성기</span>
                            </div>
                            <p class="text-[11px] text-slate-500 dark:text-slate-400 group-hover:text-slate-600 dark:group-hover:text-slate-300">소설 내지 이미지가 필요하신가요? 여기서 만들어보세요.</p>
                        </a>
                        
                        <div>
                            <h3 class="font-bold text-slate-500 dark:text-slate-400 mb-1">📖 발췌 문구 생성기 v1.4.2 (Mobile Enhanced)</h3>
                            <p>본 사이트는 어떠한 개인정보도 수집하지 않습니다.<br>모든 작업은 귀하의 브라우저에서만 이루어집니다.</p>
                        </div>
                        
                        <div class="space-y-2">
                            <h4 class="font-bold text-slate-500 dark:text-slate-400">⚠️ 이용 시 주의사항</h4>
                            <ul class="list-disc list-outside pl-3 space-y-1 text-[11px] leading-relaxed">
                                <li><strong>저작권 책임:</strong> 업로드한 이미지 및 텍스트의 저작권은 사용자에게 있으며, 저작권 침해에 대한 모든 법적 책임은 사용자에게 있습니다.</li>
                                <li><strong>이미지 사용:</strong> 타인의 저작물(사진, 일러스트 등)을 무단으로 사용하지 마세요. 저작권자의 허락을 받거나 저작권이 없는 이미지만 사용하세요.</li>
                                <li><strong>텍스트 인용:</strong> 책이나 기타 저작물의 텍스트를 발췌할 경우, 저작권법상 허용 범위 내에서 사용하고 출처를 명시하세요.</li>
                                <li><strong>플랫폼 로고:</strong> 각 플랫폼의 로고는 해당 플랫폼의 상표이며, 사용 시 각 플랫폼의 브랜드 가이드라인을 준수해야 합니다.</li>
                                <li><strong>상업적 이용:</strong> 생성된 이미지는 상업적으로 사용할 수 없습니다.</li>
                            </ul>
                            <p class="text-[10px] pt-1">본 도구의 제작자는 사용자가 생성한 콘텐츠에 대해 어떠한 책임도 지지 않습니다.<br>이미지 및 텍스트 사용으로 인해 발생하는 모든 법적 문제는 사용자 본인의 책임입니다.</p>
                        </div>
                    </footer>
                </div>
                
            </aside>

        </main>
    </div>

    <!-- Mobile Full-Screen Editor Modal -->
    <div id="mobile-editor-modal" class="fixed inset-0 z-[100] bg-white dark:bg-zinc-950 hidden-modal flex flex-col">
        <!-- Header -->
        <div class="h-14 border-b border-slate-200 dark:border-zinc-800 flex items-center justify-between px-4 bg-white dark:bg-zinc-950 flex-shrink-0">
            <span class="font-bold text-lg text-slate-800 dark:text-slate-100">텍스트 입력</span>
            <button onclick="closeMobileEditor()" class="flex items-center gap-1.5 px-3 py-1.5 bg-brand-600 text-white text-sm font-bold rounded-lg shadow-sm active:scale-95 transition-transform">
                <i class="ph ph-check text-lg"></i>
                <span>완료</span>
            </button>
        </div>
        
        <!-- Editor Body -->
        <div class="flex-1 overflow-y-auto p-4 space-y-6">
            <div class="space-y-2">
                <label class="text-sm font-medium text-slate-500">본문 내용</label>
                <textarea id="mobile-quote-input" class="w-full h-64 p-4 bg-slate-50 dark:bg-zinc-900 border border-slate-200 dark:border-zinc-800 rounded-xl resize-none focus:outline-none focus:ring-2 focus:ring-brand-500/50 transition-all text-base leading-relaxed placeholder:text-slate-400" placeholder="여기에 문구를 입력하세요..."></textarea>
            </div>
            
            <div class="space-y-4">
                <div class="space-y-2">
                    <label class="text-sm font-medium text-slate-500">제작자</label>
                    <input type="text" id="mobile-author-input" class="w-full px-4 py-3 bg-slate-50 dark:bg-zinc-900 border border-slate-200 dark:border-zinc-800 rounded-xl text-base focus:outline-none focus:ring-2 focus:ring-brand-500/50 transition-all" placeholder="제작자">
                </div>
                <div class="space-y-2">
                    <label class="text-sm font-medium text-slate-500">캐릭터/제목</label>
                    <input type="text" id="mobile-title-input" class="w-full px-4 py-3 bg-slate-50 dark:bg-zinc-900 border border-slate-200 dark:border-zinc-800 rounded-xl text-base focus:outline-none focus:ring-2 focus:ring-brand-500/50 transition-all" placeholder="캐릭터/제목">
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // --- 1. State Management & Constants ---
        
        const WELCOME_MESSAGE = `⚡️ 업데이트 완료! (v1.4.3)

✅ [NEW] PC 입력창 확장 기능 (드래그 & 원터치)        
✅ [NEW] 모바일 집중 입력 모드 (전체 화면 에디터)
✅ [NEW] 문단 첫 줄 들여쓰기 (ON/OFF)
✅ 모바일 : 버튼을 꾹~ 누르면 초고속 조절! (숫자 터치 입력도 OK)
✅ 텍스트 양쪽 정렬(Justify) 완벽 지원
✅ 제작자/캐릭터 정보 자동 정렬
✅ 배경 이미지 오버레이 & 확대/이동 자유 자재
✅ 그라데이션 방향 선택 & 디테일 컬러 피커

💡 Tip: 내용 입력창을 누르면 이 메세지는 사라져요!
`;

        const state = {
            canvas: null,
            ctx: null,
            bgImage: null,
            bgImageName: null,
            logoImages: {}, // Preloaded logos
            platform: '',
            isDarkMode: localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches),
            // Colors managed by state now (synced with Pickr)
            bgType: 'gradient', // Default to Gradient
            gradDirection: 'to bottom right',
            canvasRatio: '1:1',
            fontFamily: 'Noto Serif KR',
            indentation: false, // New Indentation State
            isEditorExpanded: false, // Desktop Editor Expansion State
            isWelcomeActive: true, // Track if welcome message is being shown
            colors: {
                text: '#4A4A4A', // Default Text Color Changed to Dark Grey for Dreamy Purple
                bgMain: '#E6E6FA', // Default Solid Color: Lavender
                gradStart: '#a18cd1', // Default Gradient Start (Dreamy Purple)
                gradEnd: '#fbc2eb',   // Default Gradient End (Dreamy Purple)
            },
            pickrs: {}
        };

        const LOGO_URLS = {
            bloom: 'https://raw.githubusercontent.com/yuliyulidaz/yulilog/refs/heads/logos/bloom.jpg',
            carat: 'https://raw.githubusercontent.com/yuliyulidaz/yulilog/refs/heads/logos/carat.png',
            caveDuck: 'https://raw.githubusercontent.com/yuliyulidaz/yulilog/refs/heads/logos/Caveduck.jpg',  
    	    dokiChat: 'https://raw.githubusercontent.com/yuliyulidaz/yulilog/refs/heads/logos/dokichat.jpg',
            inkChat: 'https://raw.githubusercontent.com/yuliyulidaz/yulilog/refs/heads/logos/inkchat.jpg',
            zeta: 'https://raw.githubusercontent.com/yuliyulidaz/yulilog/refs/heads/logos/zeta.jpg',
            luvDuv: 'https://raw.githubusercontent.com/yuliyulidaz/yulilog/refs/heads/logos/LoveyDovey.jpg',
            melting: 'https://raw.githubusercontent.com/yuliyulidaz/yulilog/refs/heads/logos/melting.jpg',
            pulse: 'https://raw.githubusercontent.com/yuliyulidaz/yulilog/refs/heads/logos/pulse.jpg',
            ropanAI: 'https://raw.githubusercontent.com/yuliyulidaz/yulilog/refs/heads/logos/rofan.png',
            crack: 'https://raw.githubusercontent.com/yuliyulidaz/yulilog/refs/heads/logos/crack.png',
            whif: 'https://raw.githubusercontent.com/yuliyulidaz/yulilog/refs/heads/logos/whif.jpg',
            chemi: 'https://raw.githubusercontent.com/yuliyulidaz/yulilog/refs/heads/logos/chemi.png',
            Fizzchat: 'https://raw.githubusercontent.com/yuliyulidaz/yulilog/refs/heads/logos/Fizzchat.png',
            reppley: 'https://raw.githubusercontent.com/yuliyulidaz/yulilog/refs/heads/logos/reppley.jpg',
            rplay: 'https://raw.githubusercontent.com/yuliyulidaz/yulilog/refs/heads/logos/rplay.png'
        };
        
        // --- 2. Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            initTheme();
            initCanvas();
            initColorPickers();
            loadLogos();
            bindEvents();
            
            // Set default styling in UI
            updateRatioUI();
            updateFontUI();
            updateDirectionUI();

            // Set Welcome Message
            const quoteInput = document.getElementById('quote');
            quoteInput.value = WELCOME_MESSAGE;
            quoteInput.classList.add('text-slate-400'); // Faded text style

            // Mobile Check to hide Copy buttons (iOS and Android)
            const isMobile = /Android|iPad|iPhone|iPod/i.test(navigator.userAgent);
            if (isMobile) {
                document.querySelectorAll('.copy-btn').forEach(el => el.style.display = 'none');
                const divider = document.getElementById('desktop-action-divider');
                if(divider) divider.style.display = 'none';
            }

            // Init Mobile Steppers (Long Press + Direct Input)
            setupMobileSteppers();

            // Font Loading Fix
            document.fonts.ready.then(() => {
                updateCanvas();
            });
            setTimeout(updateCanvas, 500);
            
            updateCanvas(); // Initial draw
        });

        // --- NEW: Mobile Stepper Logic with Long Press & Direct Input ---
        function setupMobileSteppers() {
            // Configuration for each control
            const controls = [
                { key: 'fontSize', step: 1, min: 30, max: 80 },
                { key: 'lineHeight', step: 0.1, min: 1.2, max: 2.0 },
                { key: 'paraSpacing', step: 5, min: 0, max: 100 },
                { key: 'padding', step: 10, min: 50, max: 200 }
            ];

            controls.forEach(ctrl => {
                attachStepperEvents(ctrl.key, ctrl.step, ctrl.min, ctrl.max);
            });
        }

        function attachStepperEvents(key, step, min, max) {
            const minusBtn = document.getElementById(`btn-minus-${key}`);
            const plusBtn = document.getElementById(`btn-plus-${key}`);
            const inputMobile = document.getElementById(`input-mobile-${key}`);
            const sliderDesktop = document.getElementById(key); // The hidden slider is the source of truth

            // Sync: Desktop Slider -> Mobile Input
            sliderDesktop.addEventListener('input', (e) => {
                inputMobile.value = e.target.value;
            });
            
            // Init value
            inputMobile.value = sliderDesktop.value;

            // Sync: Mobile Input Direct Change -> Desktop Slider
            inputMobile.addEventListener('change', (e) => {
                let val = parseFloat(e.target.value);
                if (isNaN(val)) val = parseFloat(sliderDesktop.value);
                if (val < min) val = min;
                if (val > max) val = max;
                
                // Update Desktop Slider
                sliderDesktop.value = val;
                inputMobile.value = val; // Reflect corrected value
                
                // Trigger canvas update via slider event
                sliderDesktop.dispatchEvent(new Event('input'));
            });

            // Long Press Logic Variables
            let pressTimer = null;
            let pressInterval = null;
            let pressSpeed = 200; // Start speed
            let pressCount = 0;

            const updateValue = (delta) => {
                let current = parseFloat(sliderDesktop.value);
                let next = current + delta;
                
                // Round for float precision
                if (step < 1) next = Math.round(next * 10) / 10;
                
                if (next >= min && next <= max) {
                    sliderDesktop.value = next;
                    inputMobile.value = next;
                    sliderDesktop.dispatchEvent(new Event('input'));
                }
            };

            const startPress = (btn, delta) => {
                // Visual Feedback
                btn.classList.add('btn-pressing');
                
                // Tip Animation Trigger
                const tipContainer = document.getElementById('mobile-tip-container');
                if (tipContainer) {
                    tipContainer.classList.remove('animate-tip');
                    void tipContainer.offsetWidth; // Trigger reflow
                    tipContainer.classList.add('animate-tip');
                    tipContainer.classList.remove('opacity-70');
                    tipContainer.classList.add('opacity-100');
                }

                // Immediate update
                updateValue(delta);

                // Reset speed logic
                pressSpeed = 200; 
                pressCount = 0;

                // Delay before rapid fire
                pressTimer = setTimeout(() => {
                    pressInterval = setInterval(() => {
                        updateValue(delta);
                        pressCount++;
                        
                        // Acceleration: Every 5 steps, speed up until max speed
                        if (pressCount % 5 === 0 && pressSpeed > 50) {
                            clearInterval(pressInterval);
                            pressSpeed = Math.max(50, pressSpeed - 30);
                            pressInterval = setInterval(() => {
                                updateValue(delta);
                                pressCount++;
                            }, pressSpeed);
                        }
                    }, pressSpeed);
                }, 400); // 400ms delay before auto-repeat
            };

            const stopPress = (btn) => {
                btn.classList.remove('btn-pressing');
                clearTimeout(pressTimer);
                clearInterval(pressInterval);
                pressTimer = null;
                pressInterval = null;
                
                // Reset Tip Opacity
                const tipContainer = document.getElementById('mobile-tip-container');
                if(tipContainer) {
                    tipContainer.classList.remove('opacity-100');
                    tipContainer.classList.add('opacity-70');
                }
            };

            // Bind Events (Touch + Mouse)
            const bindBtn = (btn, delta) => {
                // Touch
                btn.addEventListener('touchstart', (e) => {
                    e.preventDefault(); // Prevent ghost click
                    startPress(btn, delta);
                });
                btn.addEventListener('touchend', () => stopPress(btn));
                btn.addEventListener('touchcancel', () => stopPress(btn));

                // Mouse
                btn.addEventListener('mousedown', (e) => {
                    startPress(btn, delta);
                });
                btn.addEventListener('mouseup', () => stopPress(btn));
                btn.addEventListener('mouseleave', () => stopPress(btn));
            };

            bindBtn(minusBtn, -step);
            bindBtn(plusBtn, step);
        }

        // --- Existing Functions ---

        function initTheme() {
            if (state.isDarkMode) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        }

        function toggleDarkMode() {
            state.isDarkMode = !state.isDarkMode;
            localStorage.setItem('theme', state.isDarkMode ? 'dark' : 'light');
            initTheme();
        }

        function initCanvas() {
            state.canvas = document.getElementById('canvas');
            state.ctx = state.canvas.getContext('2d');
        }

        function initColorPickers() {
            const createPickr = (elId, defaultColor, key) => {
                let initialColor = defaultColor;

                const pickr = Pickr.create({
                    el: elId,
                    theme: 'classic',
                    default: defaultColor,
                    swatches: [
                        '#ef4444', '#f97316', '#f59e0b', '#84cc16', '#22c55e', '#06b6d4',
                        '#3b82f6', '#6366f1', '#8b5cf6', '#d946ef', '#f43f5e', '#000000', '#ffffff',
                        '#1a1a1a', '#0f2027', '#4b1248', '#203a43', '#2c5364', '#f0c27b'
                    ],
                    components: {
                        preview: true,
                        opacity: true,
                        hue: true,
                        interaction: {
                            hex: true,
                            input: true,
                            save: true,
                            cancel: true // 취소 버튼
                        }
                    },
                    i18n: {
                        'btn:save': '확인',
                        'btn:cancel': '취소',
                        'btn:clear': '지우기'
                    }
                });

                pickr.on('show', (color, instance) => { initialColor = state.colors[key]; });
                pickr.on('change', (color, source, instance) => {
                    const hex = color.toHEXA().toString();
                    state.colors[key] = hex;
                    updateCanvas();     
                });
                pickr.on('save', (color, instance) => {
                    const hex = color.toHEXA().toString();
                    state.colors[key] = hex;
                    instance.applyColor(true);
                    instance.hide();
                });
                pickr.on('cancel', (instance) => {
                    state.colors[key] = initialColor;
                    pickr.setColor(initialColor, true); 
                    updateCanvas();
                    instance.hide();
                });
                pickr.on('hide', (instance) => {
                     const currentColor = instance.getColor().toHEXA().toString();
                     if (state.colors[key] === currentColor) instance.applyColor(true);
                });
                pickr.on('swatchselect', (color) => {
                    const hex = color.toHEXA().toString();
                    state.colors[key] = hex;
                    pickr.setColor(hex); 
                    updateCanvas();
                });

                return pickr;
            };

            state.pickrs.text = createPickr('#textColorPicker', state.colors.text, 'text');
            state.pickrs.bgMain = createPickr('#bgColorMainPicker', state.colors.bgMain, 'bgMain');
            state.pickrs.gradStart = createPickr('#gradStartColorPicker', state.colors.gradStart, 'gradStart');
            state.pickrs.gradEnd = createPickr('#gradEndColorPicker', state.colors.gradEnd, 'gradEnd');
        }

        function loadLogos() {
            for (const [key, url] of Object.entries(LOGO_URLS)) {
                const img = new Image();
                img.crossOrigin = "Anonymous"; 
                img.src = url;
                state.logoImages[key] = img;
                img.onload = () => { if (state.platform === key) updateCanvas(); };
            }
        }

        // --- 3. Event Binding ---
        function bindEvents() {
            const quoteInput = document.getElementById('quote');
            quoteInput.addEventListener('focus', function() {
                if (state.isWelcomeActive) {
                    state.isWelcomeActive = false;
                    this.value = '';
                    this.classList.remove('text-slate-400');
                    updateCanvas();
                }
            });
            quoteInput.addEventListener('input', updateCanvas);
            
            document.getElementById('author').addEventListener('input', updateCanvas);
            document.getElementById('title').addEventListener('input', updateCanvas);

            // Desktop Sliders Events
            ['fontSize', 'lineHeight', 'paraSpacing', 'padding', 'logoSize', 'overlayOpacity', 'bgImageScale'].forEach(id => {
                const el = document.getElementById(id);
                el.addEventListener('input', (e) => {
                    // Update Text Labels
                    if(id === 'fontSize') document.getElementById('fontSizeValue').innerText = e.target.value;
                    if(id === 'lineHeight') document.getElementById('lineHeightValue').innerText = e.target.value;
                    if(id === 'paraSpacing') document.getElementById('paraSpacingValue').innerText = e.target.value;
                    if(id === 'padding') document.getElementById('paddingValue').innerText = e.target.value;
                    if(id === 'logoSize') document.getElementById('logoSizeValue').innerText = e.target.value;
                    if(id === 'bgImageScale') document.getElementById('scaleValue').innerText = e.target.value;
                    
                    if(id === 'overlayOpacity') {
                         const val = parseInt(e.target.value);
                         let text = "원본";
                         if(val < 0) text = `밝게 ${Math.abs(val)}%`;
                         if(val > 0) text = `어둡게 ${val}%`;
                         document.getElementById('overlayValueText').innerText = text;
                    }
                    updateCanvas();
                });
            });

            document.querySelectorAll('input[name="align"], input[name="linebreak"], input[name="imageFit"], input[name="imagePosition"]').forEach(el => {
                el.addEventListener('change', updateCanvas);
            });
            
            document.querySelectorAll('input[name="bgMode"]').forEach(el => {
                el.addEventListener('change', (e) => {
                    state.bgType = e.target.value;
                    togglePaletteVisibility();
                    updateCanvas();
                });
            });

            document.getElementById('platformSelect').addEventListener('change', (e) => {
                state.platform = e.target.value;
                updateCanvas();
            });

            document.getElementById('bgImageUpload').addEventListener('change', handleImageUpload);
        }

        // --- Logic Functions ---
        
        function setRatio(ratio) {
            state.canvasRatio = ratio;
            updateRatioUI();
            resizeCanvas();
            updateCanvas();
        }

        function updateRatioUI() {
            document.querySelectorAll('.ratio-btn').forEach(btn => {
                btn.classList.remove('bg-brand-50', 'dark:bg-slate-800', 'border-brand-500', 'dark:border-slate-500', 'ring-1', 'ring-brand-500', 'dark:ring-slate-500');
            });
            const idMap = { '1:1': 'btn-ratio-1-1', '4:5': 'btn-ratio-4-5', '16:9': 'btn-ratio-16-9' };
            const activeBtn = document.getElementById(idMap[state.canvasRatio]);
            if(activeBtn) {
                activeBtn.classList.add('bg-brand-50', 'dark:bg-slate-800', 'border-brand-500', 'dark:border-slate-500', 'ring-1', 'ring-brand-500', 'dark:ring-slate-500');
            }
        }

        function setFont(fontName) {
            state.fontFamily = fontName;
            updateFontUI();
            let fontWeight = '400';
            if (fontName === 'Noto Serif KR' || fontName === 'KoPub Batang') fontWeight = '300';
            else if (fontName === 'Noto Sans KR' || fontName === 'Pretendard') fontWeight = '200';
            const fontString = `${fontWeight} 40px '${fontName}'`;
            document.fonts.load(fontString).then(() => { updateCanvas(); }).catch(() => { updateCanvas(); });
            setTimeout(updateCanvas, 100);
        }

        function updateFontUI() {
            document.querySelectorAll('.font-btn').forEach(btn => {
                if(btn.dataset.font === state.fontFamily) {
                    btn.classList.add('bg-brand-50', 'dark:bg-slate-800', 'border-brand-500', 'dark:border-slate-500', 'text-brand-600', 'dark:text-brand-400', 'ring-1', 'ring-brand-500', 'dark:ring-slate-500');
                } else {
                    btn.classList.remove('bg-brand-50', 'dark:bg-slate-800', 'border-brand-500', 'dark:border-slate-500', 'text-brand-600', 'dark:text-brand-400', 'ring-1', 'ring-brand-500', 'dark:ring-slate-500');
                }
            });
        }

        function setDirection(direction) {
            state.gradDirection = direction;
            updateDirectionUI();
            updateCanvas();
        }

        function updateDirectionUI() {
            document.querySelectorAll('.dir-btn').forEach(btn => {
                if(btn.dataset.dir === state.gradDirection) {
                    btn.classList.add('active-dir', 'bg-brand-50', 'dark:bg-slate-800', 'border-brand-500', 'dark:border-slate-500', 'text-brand-600', 'dark:text-brand-400');
                } else {
                    btn.classList.remove('active-dir', 'bg-brand-50', 'dark:bg-slate-800', 'border-brand-500', 'dark:border-slate-500', 'text-brand-600', 'dark:text-brand-400');
                }
            });
        }

        function togglePaletteVisibility() {
            const solidPanel = document.getElementById('solidColorPanel');
            const gradPanel = document.getElementById('gradientColorPanel');
            const solidPalette = document.getElementById('solidPalette');
            const gradPalette = document.getElementById('gradientPalette');

            if (state.bgType === 'solid') {
                solidPanel.classList.remove('hidden');
                gradPanel.classList.add('hidden');
                solidPalette.classList.remove('hidden');
                gradPalette.classList.add('hidden');
            } else {
                solidPanel.classList.add('hidden');
                gradPanel.classList.remove('hidden');
                solidPalette.classList.add('hidden');
                gradPalette.classList.remove('hidden');
            }
        }

        function resizeCanvas() {
            let width = 1080;
            let height = 1080;
            if (state.canvasRatio === '4:5') height = 1350;
            else if (state.canvasRatio === '16:9') { width = 1920; height = 1080; }
            state.canvas.width = width;
            state.canvas.height = height;
        }

        function handleImageUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => {
                const img = new Image();
                img.onload = () => {
                    state.bgImage = img;
                    state.bgImageName = file.name;
                    document.getElementById('imageFileName').innerText = file.name;
                    document.getElementById('imageControlPanel').classList.remove('hidden');
                    updateCanvas();
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
        }

        function deleteBackgroundImage() {
            state.bgImage = null;
            state.bgImageName = null;
            document.getElementById('bgImageUpload').value = '';
            document.getElementById('imageControlPanel').classList.add('hidden');
            document.getElementById('overlayOpacity').value = 0;
            document.getElementById('overlayValueText').innerText = "원본";
            updateCanvas();
        }
        
        function clearQuoteTextOnly() {
            const quoteInput = document.getElementById('quote');
            quoteInput.value = '';
            state.isWelcomeActive = false;
            quoteInput.classList.remove('text-slate-400');
            updateCanvas();
        }

        // New Indentation Toggle Function
        function toggleIndentation() {
            state.indentation = !state.indentation;
            const btn = document.getElementById('btn-indent');
            const text = document.getElementById('text-indent');
            
            if (state.indentation) {
                btn.classList.remove('text-slate-400');
                btn.classList.add('text-brand-600', 'bg-brand-50', 'dark:bg-brand-900/30', 'border-brand-200', 'dark:border-brand-800');
                btn.classList.remove('bg-slate-50', 'dark:bg-slate-800');
                text.innerText = "들여쓰기 ON";
            } else {
                btn.classList.add('text-slate-400', 'bg-slate-50', 'dark:bg-slate-800');
                btn.classList.remove('text-brand-600', 'bg-brand-50', 'dark:bg-brand-900/30', 'border-brand-200', 'dark:border-brand-800');
                text.innerText = "들여쓰기 OFF";
            }
            updateCanvas();
        }
        
        // Desktop Editor Expand Toggle
        function toggleDesktopEditorSize() {
            const textarea = document.getElementById('quote');
            const icon = document.getElementById('icon-expand');
            state.isEditorExpanded = !state.isEditorExpanded;
            
            if (state.isEditorExpanded) {
                textarea.classList.remove('h-32');
                textarea.classList.add('h-96');
                icon.classList.remove('ph-arrows-vertical');
                icon.classList.add('ph-arrows-in-simple');
            } else {
                textarea.classList.remove('h-96');
                textarea.classList.add('h-32');
                icon.classList.remove('ph-arrows-in-simple');
                icon.classList.add('ph-arrows-vertical');
            }
        }

        function setPreset(type, color1, color2, textColor) {
            state.bgType = type;
            state.colors.text = textColor;
            if (type === 'solid') {
                state.colors.bgMain = color1;
                document.querySelector('input[name="bgMode"][value="solid"]').checked = true;
                if(state.pickrs.bgMain) state.pickrs.bgMain.setColor(color1); 
            } else {
                state.colors.gradStart = color1;
                state.colors.gradEnd = color2;
                document.querySelector('input[name="bgMode"][value="gradient"]').checked = true;
                if(state.pickrs.gradStart) state.pickrs.gradStart.setColor(color1);
                if(state.pickrs.gradEnd) state.pickrs.gradEnd.setColor(color2);
            }
            if(state.pickrs.text) state.pickrs.text.setColor(textColor);
            togglePaletteVisibility();
            updateCanvas();
        }

        // --- NEW: Mobile Editor Logic ---
        function openMobileEditor() {
            const modal = document.getElementById('mobile-editor-modal');
            const mainQuote = document.getElementById('quote');
            const mainAuthor = document.getElementById('author');
            const mainTitle = document.getElementById('title');
            
            const mobileQuote = document.getElementById('mobile-quote-input');
            const mobileAuthor = document.getElementById('mobile-author-input');
            const mobileTitle = document.getElementById('mobile-title-input');

            // Sync values from main to mobile
            mobileQuote.value = mainQuote.value;
            mobileAuthor.value = mainAuthor.value;
            mobileTitle.value = mainTitle.value;

            // Show Modal
            modal.classList.remove('hidden-modal');
            modal.classList.add('visible-modal');

            // Handle Welcome Active State removal if opening editor
            if (state.isWelcomeActive) {
                state.isWelcomeActive = false;
                mobileQuote.value = ''; // Clear welcome text for fresh input
                mainQuote.classList.remove('text-slate-400');
            }
        }

        function closeMobileEditor() {
            const modal = document.getElementById('mobile-editor-modal');
            const mainQuote = document.getElementById('quote');
            const mainAuthor = document.getElementById('author');
            const mainTitle = document.getElementById('title');
            
            const mobileQuote = document.getElementById('mobile-quote-input');
            const mobileAuthor = document.getElementById('mobile-author-input');
            const mobileTitle = document.getElementById('mobile-title-input');

            // Sync values from mobile to main
            mainQuote.value = mobileQuote.value;
            mainAuthor.value = mobileAuthor.value;
            mainTitle.value = mobileTitle.value;

            // Hide Modal
            modal.classList.remove('visible-modal');
            modal.classList.add('hidden-modal');

            // Trigger Update
            updateCanvas();
        }

        // --- 5. Drawing Core ---
        function updateCanvas() {
            if (!state.ctx) return;
            const ctx = state.ctx;
            const width = state.canvas.width;
            const height = state.canvas.height;
            ctx.clearRect(0, 0, width, height);
            drawBackground(ctx, width, height);
            drawContent(ctx, width, height);
        }

        function normalizeColor(color) {
            if (!color) return '#000000';
            if (/^#[0-9A-F]{8}$/i.test(color)) {
                const r = parseInt(color.slice(1, 3), 16);
                const g = parseInt(color.slice(3, 5), 16);
                const b = parseInt(color.slice(5, 7), 16);
                const a = parseInt(color.slice(7, 9), 16) / 255;
                return `rgba(${r}, ${g}, ${b}, ${a.toFixed(2)})`;
            }
            return color;
        }

        function drawBackground(ctx, width, height) {
            ctx.globalAlpha = 1;
            if (state.bgType === 'solid') {
                let colorMain = normalizeColor(state.colors.bgMain);
                ctx.fillStyle = colorMain;
            } else {
                let x0 = 0, y0 = 0, x1 = 0, y1 = 0;
                switch(state.gradDirection) {
                    case 'to bottom': y1 = height; break;
                    case 'to top': y0 = height; y1 = 0; break;
                    case 'to right': x1 = width; break;
                    case 'to left': x0 = width; x1 = 0; break;
                    case 'to bottom right': x1 = width; y1 = height; break;
                    case 'to top right': y0 = height; x1 = width; y1 = 0; break;
                    case 'to bottom left': x0 = width; y1 = height; break;
                    case 'to top left': x0 = width; y0 = height; break;
                }
                const grad = ctx.createLinearGradient(x0, y0, x1, y1);
                grad.addColorStop(0, normalizeColor(state.colors.gradStart));
                grad.addColorStop(1, normalizeColor(state.colors.gradEnd));
                ctx.fillStyle = grad;
            }
            ctx.fillRect(0, 0, width, height);

            if (state.bgImage) drawImage(ctx, width, height);

            const overlayVal = parseInt(document.getElementById('overlayOpacity').value);
            if (overlayVal !== 0) {
                ctx.save();
                if (overlayVal < 0) ctx.fillStyle = `rgba(255, 255, 255, ${Math.abs(overlayVal) / 100})`;
                else ctx.fillStyle = `rgba(0, 0, 0, ${overlayVal / 100})`;
                ctx.fillRect(0, 0, width, height);
                ctx.restore();
            }
        }

        function drawImage(ctx, width, height) {
            const img = state.bgImage;
            const fit = document.querySelector('input[name="imageFit"]:checked').value;
            const position = document.querySelector('input[name="imagePosition"]:checked').value;
            const scalePercent = parseInt(document.getElementById('bgImageScale').value);
            const scale = scalePercent / 100;

            let sWidth = img.width;
            let sHeight = img.height;
            let dWidth, dHeight;
            const imgRatio = sWidth / sHeight;
            const canvasRatio = width / height;

            if (fit === 'cover') {
                if (imgRatio > canvasRatio) { dHeight = height; dWidth = height * imgRatio; } 
                else { dWidth = width; dHeight = width / imgRatio; }
            } else { 
                 if (imgRatio > canvasRatio) { dWidth = width; dHeight = width / imgRatio; } 
                 else { dHeight = height; dWidth = height * imgRatio; }
            }
            dWidth *= scale;
            dHeight *= scale;

            let dx, dy;
            const [vPos, hPos] = position.split('-');
            if (hPos === 'left') dx = 0;
            else if (hPos === 'center') dx = (width - dWidth) / 2;
            else if (hPos === 'right') dx = width - dWidth;

            if (vPos === 'top') dy = 0;
            else if (vPos === 'middle') dy = (height - dHeight) / 2;
            else if (vPos === 'bottom') dy = height - dHeight;

            ctx.drawImage(img, dx, dy, dWidth, dHeight);
        }

        function drawContent(ctx, width, height) {
            const quote = document.getElementById('quote').value;
            const author = document.getElementById('author').value;
            const title = document.getElementById('title').value;
            const platform = state.platform;
            
            const fontSize = parseInt(document.getElementById('fontSize').value);
            const lineHeightMultiplier = parseFloat(document.getElementById('lineHeight').value);
            const paraSpacing = parseInt(document.getElementById('paraSpacing').value); 
            const padding = parseInt(document.getElementById('padding').value);
            const align = document.querySelector('input[name="align"]:checked').value;
            const fontFamily = state.fontFamily; 
            const breakMode = document.querySelector('input[name="linebreak"]:checked').value;
            const logoSize = parseInt(document.getElementById('logoSize').value);
            
            // Indentation Logic: Use fontSize if active, else 0
            const indentSize = state.indentation ? fontSize : 0; 

            ctx.fillStyle = state.colors.text;
            ctx.textBaseline = 'middle';

            const footerFontSize = Math.max(24, fontSize * 0.8);
            const footerLineHeight = footerFontSize * 1.5;

            let fontWeight = 400; 
            if (fontFamily === 'Noto Serif KR') fontWeight = 300;       
            else if (fontFamily === 'Noto Sans KR') fontWeight = 200;    
            else if (fontFamily === 'Pretendard') fontWeight = 200;      
            else if (fontFamily === 'KoPub Batang') fontWeight = 300;    
            
            ctx.font = `${fontWeight} ${fontSize}px '${fontFamily}'`;
            const contentWidth = width - (padding * 2);
            const lineHeight = fontSize * lineHeightMultiplier;
            const lines = getLines(ctx, quote, contentWidth, breakMode, indentSize);
            
            let quoteBlockHeight = lines.length * lineHeight;
            lines.forEach((line, i) => {
                if (!line.isSoftBreak && i < lines.length - 1) quoteBlockHeight += paraSpacing;
            });

            const hasFooterText = !!(author || title);
            const spacing = hasFooterText ? (fontSize * 1.0) : 0;
            const totalContentHeight = quoteBlockHeight + spacing + (hasFooterText ? footerLineHeight : 0);
            
            let currentY = (height - totalContentHeight) / 2 + (lineHeight / 2);

            if (quote) {
                lines.forEach((lineObj, index) => {
                    const lineText = lineObj.text;
                    const isJustify = align === 'justify' && lineObj.isSoftBreak;
                    
                    // Determine X position based on indentation
                    let currentPadding = padding;
                    let currentLineWidth = contentWidth;
                    
                    if (lineObj.isParaStart && state.indentation) {
                        currentPadding += indentSize;
                        currentLineWidth -= indentSize;
                    }

                    if (isJustify) {
                        drawJustifiedTextLine(ctx, lineText, currentPadding, currentY, currentLineWidth);
                    } else {
                        let x;
                        if (align === 'justify') { x = currentPadding; ctx.textAlign = 'left'; } 
                        else if (align === 'left') { x = currentPadding; ctx.textAlign = 'left'; } 
                        else if (align === 'center') { x = width / 2; ctx.textAlign = 'center'; } 
                        else if (align === 'right') { x = width - padding; ctx.textAlign = 'right'; }
                        ctx.fillText(lineText, x, currentY);
                    }
                    currentY += lineHeight;
                    if (!lineObj.isSoftBreak && index < lines.length - 1) currentY += paraSpacing;
                });
            }

            if (hasFooterText) {
                const startY = (height - totalContentHeight) / 2;
                currentY = startY + quoteBlockHeight + spacing + (footerLineHeight / 2);
                
                const authorPart = author || '';
                const separator = (author && title) ? ' | ' : '';
                const titlePart = title || '';

                const footerFontFamily = 'Pretendard';
                const fontNormal = `200 ${footerFontSize}px '${footerFontFamily}'`;
                const fontBold = `400 ${footerFontSize}px '${footerFontFamily}'`;

                ctx.font = fontNormal;
                const wAuthor = ctx.measureText(authorPart).width;
                const wSep = ctx.measureText(separator).width;
                ctx.font = fontBold;
                const wTitle = ctx.measureText(titlePart).width;
                const totalFooterWidth = wAuthor + wSep + wTitle;

                let startX;
                if (align === 'left' || align === 'justify') startX = padding;
                else if (align === 'center') startX = (width - totalFooterWidth) / 2;
                else if (align === 'right') startX = width - padding - totalFooterWidth;

                ctx.textAlign = 'left';
                ctx.font = fontNormal;
                ctx.fillText(authorPart, startX, currentY);
                ctx.fillText(separator, startX + wAuthor, currentY);
                ctx.font = fontBold;
                ctx.fillText(titlePart, startX + wAuthor + wSep, currentY);
            }

            const logoImg = platform ? state.logoImages[platform] : null;
            if (logoImg && logoImg.complete && logoImg.naturalHeight !== 0) {
                const radius = logoSize / 2;
                const margin = 60; 
                const logoX = width - margin - radius;
                const logoY = height - margin - radius;

                ctx.save();
                ctx.globalAlpha = 0.8;
                ctx.beginPath();
                ctx.arc(logoX, logoY, radius, 0, Math.PI * 2);
                ctx.closePath();
                ctx.clip();
                
                const aspect = logoImg.width / logoImg.height;
                let sw, sh, sx, sy;
                if (aspect > 1) { sh = logoImg.height; sw = sh; sx = (logoImg.width - sw) / 2; sy = 0; } 
                else { sw = logoImg.width; sh = sw; sx = 0; sy = (logoImg.height - sh) / 2; }

                ctx.drawImage(logoImg, sx, sy, sw, sh, logoX - radius, logoY - radius, logoSize, logoSize);
                ctx.restore();
            }
        }

        function drawJustifiedTextLine(ctx, text, x, y, width) {
            const words = text.split(' ');
            if (words.length <= 1) { ctx.textAlign = 'left'; ctx.fillText(text, x, y); return; }
            
            const totalWordWidth = words.reduce((acc, word) => acc + ctx.measureText(word).width, 0);
            const totalSpace = width - totalWordWidth;
            const spaceWidth = totalSpace / (words.length - 1);
            
            let currentX = x;
            ctx.textAlign = 'left';
            words.forEach((word, index) => {
                ctx.fillText(word, currentX, y);
                currentX += ctx.measureText(word).width;
                if (index < words.length - 1) currentX += spaceWidth;
            });
        }

        function getLines(ctx, text, maxWidth, breakMode, indentSize) {
            if (!text) return [];
            const paragraphs = text.split('\n');
            let lines = [];
            paragraphs.forEach(para => {
                let isParaStart = true;
                
                // Effective width for the first line is reduced by indentation
                let currentMaxWidth = maxWidth - (isParaStart ? indentSize : 0);

                if (breakMode === 'word') {
                    const words = para.split(' ');
                    let currentLine = words[0];
                    for (let i = 1; i < words.length; i++) {
                        const word = words[i];
                        const width = ctx.measureText(currentLine + " " + word).width;
                        if (width < currentMaxWidth) {
                             currentLine += " " + word;
                        } else { 
                            lines.push({ text: currentLine, isSoftBreak: true, isParaStart: isParaStart }); 
                            currentLine = word; 
                            isParaStart = false; // Next lines are not start of paragraph
                            currentMaxWidth = maxWidth; // Reset width for subsequent lines
                        }
                    }
                    lines.push({ text: currentLine, isSoftBreak: false, isParaStart: isParaStart });
                } else {
                    let currentLine = para[0] || '';
                    for (let i = 1; i < para.length; i++) {
                        const char = para[i];
                        const width = ctx.measureText(currentLine + char).width;
                        if (width < currentMaxWidth) {
                             currentLine += char;
                        } else { 
                            lines.push({ text: currentLine, isSoftBreak: true, isParaStart: isParaStart }); 
                            currentLine = char;
                            isParaStart = false; 
                            currentMaxWidth = maxWidth;
                        }
                    }
                    lines.push({ text: currentLine, isSoftBreak: false, isParaStart: isParaStart });
                }
            });
            return lines;
        }

        async function downloadImage() {
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
            if (isIOS && navigator.share) {
                 state.canvas.toBlob(async (blob) => {
                    const file = new File([blob], "lumina_quote.png", { type: "image/png" });
                    try { await navigator.share({ files: [file], }); } catch (err) { console.log("Share failed or canceled", err); }
                });
            } else {
                const link = document.createElement('a');
                link.download = `lumina_quote_${Date.now()}.png`;
                link.href = state.canvas.toDataURL('image/png');
                link.click();
            }
        }

        function copyImage() {
            state.canvas.toBlob(blob => {
                const item = new ClipboardItem({ "image/png": blob });
                navigator.clipboard.write([item]).then(() => { alert('클립보드에 복사되었습니다!'); })
                .catch(err => { console.error('복사 실패:', err); alert('복사에 실패했습니다.'); });
            });
        }
    </script>
</body>
</html>
