<!DOCTYPE html>
<html lang="ko" class="antialiased h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë°œì·Œ ë¬¸êµ¬ ìƒì„±ê¸° (Remastered)</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Batang:wght@400;700&family=Gowun+Dodum&family=Nanum+Myeongjo:wght@400;700;800&family=Noto+Sans+KR:wght@100;300;400;500;700&family=Noto+Serif+KR:wght@200;300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/themes/classic.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/pickr.min.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Pretendard Variable', 'sans-serif'],
                        serif: ['Noto Serif KR', 'serif'],
                    },
                    colors: {
                        brand: { 50: '#eff6ff', 100: '#dbeafe', 500: '#3b82f6', 600: '#2563eb' }
                    }
                }
            }
        }
    </script>

    <style>
        /* ì»¤ìŠ¤í…€ ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¹€ */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Range Slider ìŠ¤íƒ€ì¼ */
        input[type=range] {
            -webkit-appearance: none; background: transparent; cursor: pointer;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%;
            background: #3b82f6; margin-top: -6px; box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px; background: #e2e8f0; border-radius: 2px;
        }
        .dark input[type=range]::-webkit-slider-runnable-track { background: #3f3f46; }

        /* Contenteditable Placeholder íš¨ê³¼ */
        [contenteditable]:empty:before {
            content: attr(placeholder);
            color: rgba(156, 163, 175, 0.6);
            pointer-events: none;
            display: block;
        }
        [contenteditable]:focus { outline: none; }

        /* ëª¨ë°”ì¼ íƒ­ í™œì„±í™” ìŠ¤íƒ€ì¼ */
        .tab-btn.active { color: #2563eb; background-color: #eff6ff; border-color: #bfdbfe; }
        .dark .tab-btn.active { color: #60a5fa; background-color: rgba(30, 58, 138, 0.3); border-color: #1e40af; }
    </style>
</head>
<body class="h-full bg-slate-50 dark:bg-zinc-950 text-slate-900 dark:text-slate-100 overflow-hidden flex flex-col">

    <header class="h-14 bg-white dark:bg-zinc-900 border-b border-slate-200 dark:border-zinc-800 flex items-center justify-between px-4 z-50 shrink-0">
        <div class="flex items-center gap-2">
            <div class="w-8 h-8 bg-brand-600 rounded-lg flex items-center justify-center text-white shadow-lg">
                <i class="ph ph-quotes text-xl"></i>
            </div>
            <h1 class="font-bold text-lg hidden md:block">ë°œì·Œ ë¬¸êµ¬ ìƒì„±ê¸°</h1>
        </div>
        <div class="flex items-center gap-2">
            <button onclick="toggleDarkMode()" class="w-9 h-9 rounded-full flex items-center justify-center hover:bg-slate-100 dark:hover:bg-zinc-800 transition">
                <i class="ph ph-moon text-xl" id="dark-icon"></i>
            </button>
            <button onclick="exportImage()" class="flex items-center gap-2 px-4 py-2 bg-brand-600 text-white text-sm font-bold rounded-full shadow-lg active:scale-95 transition-transform">
                <i class="ph ph-download-simple text-lg"></i>
                <span id="save-btn-text">ì €ì¥</span>
            </button>
        </div>
    </header>

    <main class="flex-1 flex flex-col md:flex-row overflow-hidden relative">
        
        <section class="flex-1 bg-slate-100 dark:bg-black/50 relative flex flex-col items-center justify-center p-4 md:p-10 overflow-hidden">
            
            <div id="canvas-wrapper" class="relative shadow-2xl transition-all duration-300">
                <div id="capture-area" class="relative bg-white overflow-hidden select-none flex flex-col" style="width: 100%; aspect-ratio: 1/1;">
                    
                    <div id="preview-bg" class="absolute inset-0 z-0 w-full h-full transition-colors duration-300"></div>
                    
                    <div id="preview-overlay" class="absolute inset-0 z-10 w-full h-full pointer-events-none transition-colors duration-300"></div>

                    <div id="preview-content" class="relative z-20 w-full h-full flex flex-col items-center justify-center p-12 transition-all duration-300">
                        
                        <div id="text-editor" 
                             contenteditable="true" 
                             spellcheck="false"
                             placeholder="ì—¬ê¸°ë¥¼ ëˆŒëŸ¬ ë¬¸êµ¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
                             class="w-full text-center whitespace-pre-wrap break-words outline-none"
                             style="font-family: 'Noto Serif KR'; font-size: 32px; line-height: 1.6; color: #1e293b;">
                        </div>

                        <div id="footer-info" class="mt-8 flex items-center gap-2 text-sm opacity-60 font-light hidden">
                            <span id="footer-author"></span>
                            <span id="footer-sep">|</span>
                            <span id="footer-title"></span>
                        </div>
                    </div>

                    <img id="logo-img" src="" class="absolute bottom-6 right-6 w-16 h-16 rounded-full object-cover z-30 hidden opacity-80" alt="Platform Logo">
                </div>
            </div>
            
            <div class="md:hidden absolute bottom-4 text-xs text-slate-400 bg-white/80 dark:bg-black/50 px-3 py-1 rounded-full backdrop-blur-sm pointer-events-none">
                ğŸ’¡ í…ìŠ¤íŠ¸ ì˜ì—­ì„ í„°ì¹˜í•´ ì§ì ‘ ê¸€ì„ ì¨ë³´ì„¸ìš”
            </div>
        </section>

        <aside class="w-full md:w-[400px] bg-white dark:bg-zinc-900 border-t md:border-t-0 md:border-r border-slate-200 dark:border-zinc-800 flex flex-col z-40 h-[45vh] md:h-full shadow-top md:shadow-none order-2 md:order-1">
            
            <div class="md:hidden flex border-b border-slate-200 dark:border-zinc-800 overflow-x-auto no-scrollbar shrink-0">
                <button onclick="switchTab('tab-text')" class="tab-btn active flex-1 min-w-[70px] py-3 text-xs font-bold text-slate-500 border-b-2 border-transparent transition-colors">í…ìŠ¤íŠ¸</button>
                <button onclick="switchTab('tab-font')" class="tab-btn flex-1 min-w-[70px] py-3 text-xs font-bold text-slate-500 border-b-2 border-transparent transition-colors">ìŠ¤íƒ€ì¼</button>
                <button onclick="switchTab('tab-bg')" class="tab-btn flex-1 min-w-[70px] py-3 text-xs font-bold text-slate-500 border-b-2 border-transparent transition-colors">ë°°ê²½</button>
                <button onclick="switchTab('tab-deco')" class="tab-btn flex-1 min-w-[70px] py-3 text-xs font-bold text-slate-500 border-b-2 border-transparent transition-colors">ê¾¸ë¯¸ê¸°</button>
            </div>

            <div class="flex-1 overflow-y-auto p-5 space-y-8 pb-10 custom-scrollbar relative" id="control-container">
                
                <div id="tab-text" class="control-section space-y-5">
                    <h3 class="hidden md:block text-xs font-bold text-slate-400 uppercase tracking-wider mb-4">ë‚´ìš© ì„¤ì •</h3>
                    
                    <div class="grid grid-cols-2 gap-3">
                         <div class="space-y-1">
                            <label class="text-xs font-medium text-slate-500">ì œì‘ì</label>
                            <input type="text" id="input-author" placeholder="ì‘ê°€/ì¶œì²˜" class="w-full p-2 bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-zinc-700 rounded text-sm focus:border-brand-500 outline-none">
                         </div>
                         <div class="space-y-1">
                            <label class="text-xs font-medium text-slate-500">ì‘í’ˆëª…</label>
                            <input type="text" id="input-title" placeholder="ì‘í’ˆëª…" class="w-full p-2 bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-zinc-700 rounded text-sm focus:border-brand-500 outline-none">
                         </div>
                    </div>
                    
                    <div class="flex gap-2">
                        <button onclick="toggleQuoteEffect()" class="flex-1 py-2 text-xs border border-slate-200 dark:border-zinc-700 rounded hover:bg-slate-50 dark:hover:bg-zinc-800 transition flex items-center justify-center gap-1">
                            <i class="ph ph-quotes"></i> ë”°ì˜´í‘œ ìë™ë³€í™˜
                        </button>
                        <button onclick="document.getElementById('text-editor').innerHTML=''" class="px-3 py-2 text-xs text-red-500 border border-red-100 bg-red-50 rounded hover:bg-red-100 transition">
                            <i class="ph ph-trash"></i>
                        </button>
                    </div>
                </div>

                <div id="tab-font" class="control-section space-y-6 md:block hidden">
                    <h3 class="hidden md:block text-xs font-bold text-slate-400 uppercase tracking-wider mb-4">ìŠ¤íƒ€ì¼ ì„¤ì •</h3>
                    
                    <div class="space-y-2">
                        <label class="text-xs font-medium text-slate-500">í°íŠ¸</label>
                        <select id="font-select" class="w-full p-2 bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-zinc-700 rounded text-sm focus:border-brand-500 outline-none">
                            <option value="Noto Serif KR" style="font-family: 'Noto Serif KR'">ë³¸ëª…ì¡° (ê¸°ë³¸)</option>
                            <option value="Noto Sans KR" style="font-family: 'Noto Sans KR'">ë³¸ê³ ë”• (ê¹”ë”)</option>
                            <option value="Gowun Batang" style="font-family: 'Gowun Batang'">ê³ ìš´ë°”íƒ• (ê°ì„±)</option>
                            <option value="Gowun Dodum" style="font-family: 'Gowun Dodum'">ê³ ìš´ë‹ì›€ (ê·€ì—¬ì›€)</option>
                            <option value="Nanum Myeongjo" style="font-family: 'Nanum Myeongjo'">ë‚˜ëˆ”ëª…ì¡° (ì§„ì§€)</option>
                            <option value="Pretendard" style="font-family: 'Pretendard'">í”„ë¦¬í…ë‹¤ë“œ (ëª¨ë˜)</option>
                        </select>
                    </div>

                    <div class="flex bg-slate-50 dark:bg-black/20 p-1 rounded-lg border border-slate-200 dark:border-zinc-700">
                        <button onclick="setAlignment('left')" class="flex-1 py-1.5 rounded hover:bg-white dark:hover:bg-zinc-700 hover:shadow-sm transition"><i class="ph ph-text-align-left"></i></button>
                        <button onclick="setAlignment('center')" class="flex-1 py-1.5 rounded hover:bg-white dark:hover:bg-zinc-700 hover:shadow-sm transition"><i class="ph ph-text-align-center"></i></button>
                        <button onclick="setAlignment('right')" class="flex-1 py-1.5 rounded hover:bg-white dark:hover:bg-zinc-700 hover:shadow-sm transition"><i class="ph ph-text-align-right"></i></button>
                    </div>

                    <div class="space-y-4">
                        <div class="space-y-1">
                            <div class="flex justify-between text-xs text-slate-500"><span>í¬ê¸°</span><span id="val-size">32px</span></div>
                            <input type="range" id="range-size" min="16" max="80" value="32" step="1">
                        </div>
                        <div class="space-y-1">
                            <div class="flex justify-between text-xs text-slate-500"><span>ì¤„ê°„ê²©</span><span id="val-height">1.6</span></div>
                            <input type="range" id="range-height" min="1.0" max="3.0" value="1.6" step="0.1">
                        </div>
                        <div class="space-y-1">
                            <div class="flex justify-between text-xs text-slate-500"><span>ì—¬ë°±</span><span id="val-padding">48px</span></div>
                            <input type="range" id="range-padding" min="20" max="150" value="48" step="4">
                        </div>
                    </div>
                </div>

                <div id="tab-bg" class="control-section space-y-6 md:block hidden">
                    <h3 class="hidden md:block text-xs font-bold text-slate-400 uppercase tracking-wider mb-4">ë°°ê²½ ì„¤ì •</h3>
                    
                    <div class="grid grid-cols-3 gap-2">
                        <button onclick="setRatio('1/1')" class="py-2 text-xs border border-brand-500 text-brand-600 bg-brand-50 rounded ratio-btn" data-r="1/1">1:1</button>
                        <button onclick="setRatio('4/5')" class="py-2 text-xs border border-slate-200 dark:border-zinc-700 rounded ratio-btn" data-r="4/5">4:5</button>
                        <button onclick="setRatio('16/9')" class="py-2 text-xs border border-slate-200 dark:border-zinc-700 rounded ratio-btn" data-r="16/9">16:9</button>
                    </div>

                    <div class="flex gap-2 text-xs">
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="bg-mode" value="solid" checked> ë‹¨ìƒ‰</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="bg-mode" value="gradient"> ê·¸ë¼ë°ì´ì…˜</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="bg-mode" value="image"> ì´ë¯¸ì§€</label>
                    </div>

                    <div id="color-controls" class="space-y-3">
                        <div class="flex items-center justify-between">
                            <span class="text-xs font-medium text-slate-500">ë°°ê²½ìƒ‰</span>
                            <div id="picker-bg"></div>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-xs font-medium text-slate-500">ê¸€ììƒ‰</span>
                            <div id="picker-text"></div>
                        </div>
                    </div>

                    <div id="image-controls" class="hidden space-y-3">
                        <label class="block w-full h-20 border-2 border-dashed border-slate-300 dark:border-zinc-700 rounded-lg flex flex-col items-center justify-center text-xs text-slate-500 cursor-pointer hover:bg-slate-50 dark:hover:bg-zinc-800 transition">
                            <i class="ph ph-image text-xl mb-1"></i> ë°°ê²½ ì´ë¯¸ì§€ ì„ íƒ
                            <input type="file" id="input-bg-image" accept="image/*" class="hidden">
                        </label>
                        <div class="space-y-1">
                            <div class="flex justify-between text-xs text-slate-500"><span>ì–´ë‘¡ê²Œ (ì˜¤ë²„ë ˆì´)</span><span id="val-overlay">0%</span></div>
                            <input type="range" id="range-overlay" min="0" max="90" value="0">
                        </div>
                    </div>
                </div>

                <div id="tab-deco" class="control-section space-y-6 md:block hidden">
                    <h3 class="hidden md:block text-xs font-bold text-slate-400 uppercase tracking-wider mb-4">ê¾¸ë¯¸ê¸°</h3>
                    
                    <div class="space-y-2">
                        <label class="text-xs font-medium text-slate-500">í”Œë«í¼ ë¡œê³ </label>
                        <select id="logo-select" class="w-full p-2 bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-zinc-700 rounded text-sm focus:border-brand-500 outline-none">
                            <option value="">(ì—†ìŒ)</option>
                            <option value="ridi">ë¦¬ë””ë¶ìŠ¤</option>
                            <option value="kakaopage">ì¹´ì¹´ì˜¤í˜ì´ì§€</option>
                            <option value="series">ë„¤ì´ë²„ ì‹œë¦¬ì¦ˆ</option>
                            <option value="bomtoon">ë´„íˆ°</option>
                            <option value="lezhin">ë ˆì§„ì½”ë¯¹ìŠ¤</option>
                            <option value="postype">í¬ìŠ¤íƒ€ì…</option>
                        </select>
                    </div>

                    <div class="space-y-1">
                        <div class="flex justify-between text-xs text-slate-500"><span>ë¡œê³  í¬ê¸°</span><span id="val-logo">64px</span></div>
                        <input type="range" id="range-logo" min="30" max="150" value="64">
                    </div>
                </div>

            </div>
        </aside>

    </main>

    <script>
        // --- ìƒíƒœ ê´€ë¦¬ ---
        const state = {
            colors: { bg: '#E6E6FA', text: '#1e293b' },
            bgMode: 'solid',
            font: 'Noto Serif KR',
            align: 'center',
            ratio: '1/1',
            logoUrl: ''
        };

        const LOGOS = {
            ridi: 'https://upload.wikimedia.org/wikipedia/commons/2/22/Ridibooks_Icon.png', // ì˜ˆì‹œ (ì‹¤ì œ URL êµì²´ í•„ìš”)
            kakaopage: 'https://upload.wikimedia.org/wikipedia/commons/f/f2/KakaoPage_Icon.png',
            // ... í•„ìš”í•œ ë¡œê³  URL ì¶”ê°€
        };

        // --- ì´ˆê¸°í™” ---
        document.addEventListener('DOMContentLoaded', () => {
            initPickr();
            setupEventListeners();
            
            // ëª¨ë°”ì¼ ì´ˆê¸° íƒ­ ì„¤ì •
            if(window.innerWidth < 768) {
                switchTab('tab-text');
            }
            
            // ë‹¤í¬ëª¨ë“œ ì´ˆê¸°í™”
            if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            }
        });

        // --- ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸ (DOM ì¡°ì‘) ---
        function updatePreview() {
            const editor = document.getElementById('text-editor');
            const wrapper = document.getElementById('preview-content');
            const bgLayer = document.getElementById('preview-bg');
            const captureArea = document.getElementById('capture-area');

            // 1. í°íŠ¸ & ìŠ¤íƒ€ì¼ ì ìš©
            editor.style.fontFamily = document.getElementById('font-select').value;
            editor.style.textAlign = state.align;
            
            const size = document.getElementById('range-size').value;
            editor.style.fontSize = `${size}px`;
            document.getElementById('val-size').innerText = `${size}px`;

            const height = document.getElementById('range-height').value;
            editor.style.lineHeight = height;
            document.getElementById('val-height').innerText = height;

            const padding = document.getElementById('range-padding').value;
            wrapper.style.padding = `${padding}px`;
            document.getElementById('val-padding').innerText = `${padding}px`;

            editor.style.color = state.colors.text;
            
            // 2. ë°°ê²½ ì ìš©
            bgLayer.style.background = 'none';
            bgLayer.style.backgroundImage = 'none';
            
            if (state.bgMode === 'solid') {
                bgLayer.style.backgroundColor = state.colors.bg;
            } else if (state.bgMode === 'gradient') {
                bgLayer.style.backgroundImage = `linear-gradient(135deg, ${state.colors.bg}, #ffffff)`; 
            } else if (state.bgMode === 'image') {
                // ì´ë¯¸ì§€ëŠ” file input ì´ë²¤íŠ¸ì—ì„œ ì²˜ë¦¬
            }

            // 3. ë¹„ìœ¨ ì ìš©
            captureArea.style.aspectRatio = state.ratio;

            // 4. ë¡œê³  ì ìš©
            const logoSize = document.getElementById('range-logo').value;
            const logoImg = document.getElementById('logo-img');
            logoImg.style.width = `${logoSize}px`;
            logoImg.style.height = `${logoSize}px`;
            document.getElementById('val-logo').innerText = `${logoSize}px`;
            
            // 5. í•˜ë‹¨ ì •ë³´ (ì œì‘ì/ì‘í’ˆëª…)
            const author = document.getElementById('input-author').value;
            const title = document.getElementById('input-title').value;
            const footer = document.getElementById('footer-info');
            
            if(author || title) {
                footer.classList.remove('hidden');
                document.getElementById('footer-author').innerText = author;
                document.getElementById('footer-title').innerText = title;
                document.getElementById('footer-sep').style.display = (author && title) ? 'inline' : 'none';
                footer.style.color = state.colors.text;
                // í°íŠ¸ í¬ê¸°ì— ë¹„ë¡€í•˜ì—¬ í‘¸í„° í¬ê¸° ì¡°ì •
                footer.style.fontSize = Math.max(12, size * 0.4) + 'px';
            } else {
                footer.classList.add('hidden');
            }
        }

        // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ---
        function setupEventListeners() {
            // ì…ë ¥ ê°ì§€ (ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸°ëŠ” contenteditableì´ë¼ í•„ìš”ì—†ì§€ë§Œ footer ë“± ì—°ë™ ìœ„í•´)
            document.getElementById('input-author').addEventListener('input', updatePreview);
            document.getElementById('input-title').addEventListener('input', updatePreview);

            // ìŠ¬ë¼ì´ë”ë“¤
            ['range-size', 'range-height', 'range-padding', 'range-logo'].forEach(id => {
                document.getElementById(id).addEventListener('input', updatePreview);
            });

            // ì˜¤ë²„ë ˆì´
            document.getElementById('range-overlay').addEventListener('input', (e) => {
                const val = e.target.value;
                document.getElementById('preview-overlay').style.backgroundColor = `rgba(0,0,0, ${val/100})`;
                document.getElementById('val-overlay').innerText = `${val}%`;
            });

            // í°íŠ¸ ë³€ê²½
            document.getElementById('font-select').addEventListener('change', updatePreview);

            // ë°°ê²½ ëª¨ë“œ ë³€ê²½
            document.querySelectorAll('input[name="bg-mode"]').forEach(r => {
                r.addEventListener('change', (e) => {
                    state.bgMode = e.target.value;
                    const colorControls = document.getElementById('color-controls');
                    const imgControls = document.getElementById('image-controls');
                    
                    if (state.bgMode === 'image') {
                        colorControls.classList.add('hidden');
                        imgControls.classList.remove('hidden');
                    } else {
                        colorControls.classList.remove('hidden');
                        imgControls.classList.add('hidden');
                        updatePreview();
                    }
                });
            });

            // ë°°ê²½ ì´ë¯¸ì§€ ì—…ë¡œë“œ
            document.getElementById('input-bg-image').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (evt) => {
                        const bgLayer = document.getElementById('preview-bg');
                        bgLayer.style.backgroundImage = `url(${evt.target.result})`;
                        bgLayer.style.backgroundSize = 'cover';
                        bgLayer.style.backgroundPosition = 'center';
                        state.bgMode = 'image';
                    };
                    reader.readAsDataURL(file);
                }
            });

            // ë¡œê³  ì„ íƒ
            document.getElementById('logo-select').addEventListener('change', (e) => {
                const val = e.target.value;
                const img = document.getElementById('logo-img');
                if(val && LOGOS[val]) { // (ë°ëª¨ìš©: ì‹¤ì œë¡  LOGOSì— URL ë§¤í•‘ í•„ìš”)
                    // ë°ëª¨ìš© í”Œë ˆì´ìŠ¤í™€ë” ë¡œì§
                    img.src = `https://via.placeholder.com/150?text=${val}`; 
                    // ì‹¤ì œ ì‚¬ìš©ì‹œ: img.src = LOGOS[val];
                    img.classList.remove('hidden');
                } else if (val) {
                     // ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„  LOGOS ê°ì²´ì— URL ë„£ì–´ì£¼ì„¸ìš”. ì—¬ê¸°ì„  ì„ì‹œ ì²˜ë¦¬
                     img.src = "https://via.placeholder.com/100";
                     img.classList.remove('hidden');
                } else {
                    img.classList.add('hidden');
                }
            });
        }

        // --- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---

        function setAlignment(align) {
            state.align = align;
            updatePreview();
        }

        function setRatio(ratio) {
            state.ratio = ratio;
            // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.ratio-btn').forEach(btn => {
                if(btn.dataset.r === ratio) {
                    btn.classList.add('border-brand-500', 'text-brand-600', 'bg-brand-50');
                    btn.classList.remove('border-slate-200', 'dark:border-zinc-700');
                } else {
                    btn.classList.remove('border-brand-500', 'text-brand-600', 'bg-brand-50');
                    btn.classList.add('border-slate-200', 'dark:border-zinc-700');
                }
            });
            updatePreview();
        }

        function toggleQuoteEffect() {
            const editor = document.getElementById('text-editor');
            let text = editor.innerText;
            // ë‹¨ìˆœ ë³€í™˜ ë¡œì§ (ì •êµí•˜ê²Œ í•˜ë ¤ë©´ ì •ê·œì‹ ê°•í™” í•„ìš”)
            text = text.replace(/"/g, 'â€œ').replace(/'/g, 'â€˜'); // ì‹œì‘ ë”°ì˜´í‘œë¡œ í‰ì¹¨ (ê°„ì†Œí™”)
            editor.innerText = text;
        }

        function toggleDarkMode() {
            document.documentElement.classList.toggle('dark');
            localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
        }

        // --- íƒ­ ì „í™˜ (ëª¨ë°”ì¼) ---
        function switchTab(tabId) {
            // ë²„íŠ¼ í™œì„±í™”
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.currentTarget.classList.add('active');

            // ì„¹ì…˜ ë³´ì´ê¸°/ìˆ¨ê¸°ê¸° (PCì—ì„œëŠ” ëª¨ë‘ ë³´ì„)
            if (window.innerWidth < 768) {
                document.querySelectorAll('.control-section').forEach(sec => sec.classList.add('hidden'));
                document.getElementById(tabId).classList.remove('hidden');
            }
        }

        // --- Color Picker ì´ˆê¸°í™” ---
        function initPickr() {
            const createPickr = (el, defaultColor, type) => {
                const pickr = Pickr.create({
                    el: el,
                    theme: 'classic',
                    default: defaultColor,
                    components: {
                        preview: true, opacity: true, hue: true,
                        interaction: { input: true, save: true }
                    },
                    i18n: { 'btn:save': 'ì ìš©' }
                });
                pickr.on('save', (color, instance) => {
                    const hex = color.toHEXA().toString();
                    if(type === 'bg') state.colors.bg = hex;
                    else state.colors.text = hex;
                    updatePreview();
                    instance.hide();
                });
            };

            createPickr('#picker-bg', state.colors.bg, 'bg');
            createPickr('#picker-text', state.colors.text, 'text');
        }

        // --- ì €ì¥ ë° ê³µìœ  (iOS ëŒ€ì‘) ---
        function exportImage() {
            const captureArea = document.getElementById('capture-area');
            const btnText = document.getElementById('save-btn-text');
            btnText.innerText = "ìƒì„± ì¤‘...";

            // html2canvas ì˜µì…˜: scale 3ìœ¼ë¡œ ê³ í™”ì§ˆ
            html2canvas(captureArea, {
                scale: 3,
                useCORS: true, // ì™¸ë¶€ ì´ë¯¸ì§€(ë¡œê³ ) í—ˆìš©
                backgroundColor: null,
                logging: false
            }).then(canvas => {
                canvas.toBlob(async (blob) => {
                    const fileName = `quote_${Date.now()}.png`;
                    const file = new File([blob], fileName, { type: 'image/png' });

                    // iOS ë“± ëª¨ë°”ì¼ ê³µìœ  API ì§€ì› ì‹œ
                    if (navigator.share && /iPad|iPhone|iPod|Android/.test(navigator.userAgent)) {
                        try {
                            await navigator.share({
                                files: [file],
                                title: 'ë¬¸êµ¬ ì €ì¥',
                            });
                            btnText.innerText = "ì €ì¥";
                        } catch (err) {
                            // ê³µìœ  ì·¨ì†Œí•˜ê±°ë‚˜ ì‹¤íŒ¨ ì‹œ ë‹¤ìš´ë¡œë“œë¡œ í´ë°±
                            console.log('Sharing failed', err);
                            downloadLink(canvas, fileName);
                        }
                    } else {
                        // PC ë‹¤ìš´ë¡œë“œ
                        downloadLink(canvas, fileName);
                    }
                    btnText.innerText = "ì €ì¥";
                });
            });
        }

        function downloadLink(canvas, fileName) {
            const link = document.createElement('a');
            link.download = fileName;
            link.href = canvas.toDataURL('image/png');
            link.click();
        }

        // ì´ˆê¸° ì‹¤í–‰
        updatePreview();
    </script>
</body>
</html>
